# DCP版本混淆问题与解决方案

## 问题本质：混淆而非版本差异

### 是混淆问题，不是版本需要更正

经过源码验证，**不存在版本差异**：
- GitHub 官方版和 npm 版 v2.0.2 实际工具名一致
- 都提供：`prune, distill, compress`
- **真正问题**：信息来源不一致导致的认知混淆

### 混淆的来源

1. **npm 页面信息错误/滞后**
   - 我查看到的 `discard/extract` 是错误信息
   - npm 包实际暴露的是 `prune/distill/compress`

2. **没有以源码为准**
   - 轻信了二手文档（npm页面）
   - 没有第一时间查看 `dist/index.js` 源码

3. **默认配置激进**
   - 自动清理策略频繁执行
   - 加深了对工具行为的不理解

---

## 接下来要怎么做

### 1. 立即行动：统一信息来源

**创建配置模板**
```json
{
  "$schema": "https://raw.githubusercontent.com/Opencode-DCP/opencode-dynamic-context-pruning/master/dcp.schema.json",
  "tools": {
    "prune": {
      "permission": "ask"  // 改为询问，避免自动清理
    },
    "distill": {
      "permission": "allow"  // 保留自动蒸馏
    },
    "compress": {
      "permission": "deny"  // 关闭压缩
    }
  },
  "strategies": {
    "deduplication": {
      "enabled": true  // 保留去重
    },
    "supersedeWrites": {
      "enabled": false  // 关闭替代写入
    },
    "purgeErrors": {
      "enabled": true,
      "turns": 10  // 延长到10轮
    }
  }
}
```

### 2. 长期措施：建立工作规范

**以源码为唯一真相来源**
- 遇到工具差异时，优先看 `dist/index.js`
- 文档只作参考，以源码为准
- 建立证据链：源码片段 + 文件路径 + 版本号

**信息核实流程**
1. 用户提出疑问 → 立即停止辩解
2. 查看源码/官方文档 → 获取一手证据
3. 基于证据回答 → 不再凭记忆
4. 提供证据链接 → 让用户可验证

### 3. 配置优化：解决实际问题

**当前问题**
- prune 过于频繁，影响调试
- 错误信息清理太快，不便回溯
- 上下文丢失，影响连续性

**解决方案**
- prune 权限改为 "ask"，需要确认才执行
- 延长错误清理轮次（4轮→10轮）
- 关闭不必要的自动策略

---

## 执行步骤

### 第一步：更新 dcp.jsonc
[ ] 写入新配置模板
[ ] 测试 prune 行为是否收敛
[ ] 验证错误轮次是否延长

### 第二步：验证效果
[ ] 进行多轮对话测试
[ ] 确认 prune 不再自动频繁执行
[ ] 检查错误信息是否保留更久

### 第三步：文档完善
[ ] 在主笔记中记录配置变更
[ ] 创建"问题解决指南"附录
[ ] 建立源码优先的工作流程文档

---

## 结论

**核心问题**：信息混淆，不是版本差异
**解决方案**：统一以源码为准，调整默认策略
**预防措施**：建立"先验证后回答"的工作习惯

---

**创建时间**: 2026-02-10 当前时间  
**状态**: 准备执行配置更新