# memU 安装研究文档

**创建时间**: 2026-02-05 10:53:49  
**文档版本**: v1.0  
**研究状态**: 已完成详细研究  
**适用环境**: Windows 11 + Git Bash  
**最后更新**: 2026-02-05 10:57:00

---

## 目录

1. [项目概述](#一项目概述)
2. [安装方法总览](#二安装方法总览)
3. [方法一：Cloud版本安装](#三方法一cloud版本安装)
4. [方法二：Self-Hosted版本安装](#四方法二self-hosted版本安装)
5. [环境依赖详细检查](#五环境依赖详细检查)
6. [详细安装步骤](#六详细安装步骤)
7. [常见问题与解决方案](#七常见问题与解决方案)
8. [使用方法详解](#八使用方法详解)
9. [性能与配置](#九性能与配置)
10. [总结与建议](#十总结与建议)
11. [附录](#附录)

---

## 一、项目概述

### 1.1 memU是什么

**memU** = Memory for You，一个为**24/7全天候主动式Agent**设计的记忆框架。

memU的核心价值主张是：
- **持续学习**：从每次用户交互中自动学习，无需显式的记忆命令
- **降低成本**：通过缓存洞察和避免冗余的LLM调用，显著降低长期运行的Token成本
- **主动预测**：即使没有命令，Agent也能理解用户即将要做什么并自主行动

### 1.2 核心特性

| 特性 | 描述 | 价值 |
|------|------|------|
| 🤖 **24/7主动式Agent** | 始终在线的内存Agent，在后台持续工作，永不休眠，永不遗忘 | 自动化监控和学习 |
| 🎯 **用户意图捕获** | 自动跨会话理解并记住用户目标、偏好和上下文 | 个性化服务 |
| 💰 **成本效益** | 通过缓存洞察和避免冗余LLM调用，降低长期运行成本 | 节省Token消耗 |
| 🗂️ **层级记忆架构** | 像文件系统一样组织记忆：文件夹→类别，文件→记忆项 | 结构化存储 |
| 🔗 **跨引用链接** | 像符号链接一样，记忆之间可以相互引用 | 知识图谱 |
| 📥 **资源挂载** | 原始对话、文档、图片可以挂载为可查询记忆 | 完整上下文 |

### 1.3 记忆vs文件系统对比

| 文件系统概念 | memU记忆概念 | 说明 |
|------------|-------------|------|
| 📁 文件夹 | 🏷️ 类别（自动组织主题） | 自动分类整理 |
| 📄 文件 | 🧠 记忆项（提取的事实、偏好、技能） | 结构化记忆 |
| 🔗 符号链接 | 🔄 跨引用（关联记忆的链接） | 知识关联 |
| 📂 挂载点 | 📥 资源（对话、文档、图片） | 原始数据接入 |

### 1.4 项目信息

| 资源 | 链接 |
|------|------|
| **GitHub仓库** | https://github.com/NevaMind-AI/memU |
| **官方网站** | https://memu.so |
| **云服务入口** | https://app.memu.so/quick-start |
| **API文档** | https://memu.pro/docs |
| **Discord社区** | https://discord.gg/memu |
| **许可证** | Apache 2.0 |
| **Python要求** | 3.13+ |

---

## 二、安装方法总览

memU提供**两种安装方法**，适用于不同的使用场景和用户需求。

### 2.1 方法对比表

| 对比维度 | 方法一：Cloud版本 | 方法二：Self-Hosted |
|----------|------------------|---------------------|
| **访问地址** | https://memu.so | 本地安装 |
| **安装复杂度** | ⭐ 无需安装 | ⭐⭐⭐ 需要配置 |
| **技术要求** | 零要求 | Python 3.13+、Docker（可选） |
| **数据存储** | 云端服务器 | 本地/自建服务器 |
| **自定义程度** | 受限 | 完全自定义 |
| **成本** | 有免费额度，企业版付费 | 完全免费（自建） |
| **维护成本** | 无需维护 | 需要自己维护 |
| **启动时间** | 即时（分钟级） | 较慢（小时级） |
| **适合人群** | 新手体验、临时使用 | 开发者、长期项目 |
| **网络依赖** | 必须联网 | 可选（本地模式） |
| **数据安全** | 数据在云端 | 数据完全本地 |

### 2.2 选择建议

#### 选择Cloud版本的情况
- ✅ 想要快速体验memU功能
- ✅ 不想配置复杂的环境
- ✅ 临时项目或短期使用
- ✅ 可以接受数据存储在云端
- ✅ 网络稳定，可以访问外部服务

#### 选择Self-Hosted版本的情况
- ✅ 需要完全本地部署
- ✅ 数据敏感性高，不能存储在云端
- ✅ 长期项目，需要稳定的环境
- ✅ 有技术能力维护本地服务
- ✅ 需要与现有系统集成

### 2.3 推荐的组合方案

**最佳实践**：同时使用两种方法

| 使用场景 | 推荐方案 |
|---------|---------|
| **日常开发** | Self-Hosted版本（本地） |
| **快速测试** | Cloud版本（在线） |
| **演示展示** | Cloud版本（便捷） |
| **生产环境** | Self-Hosted版本（可控） |
| **学习研究** | Cloud版本（简单） |

---

## 三、方法一：Cloud版本安装

### 3.1 概述

Cloud版本是memU官方托管的服务，无需安装任何软件，通过浏览器直接访问使用。

### 3.2 访问地址

| 服务类型 | 地址 | 说明 |
|---------|------|------|
| **主入口** | https://memu.so | memU官方网站 |
| **云服务** | https://app.memu.so/quick-start | 快速开始页面 |
| **API文档** | https://memu.pro/docs | 云版本API文档 |

### 3.3 注册与使用流程

#### 步骤1：访问官网

```
打开浏览器，访问：https://memu.so
```

#### 步骤2：注册账号

```
1. 点击"Sign Up"或"注册"
2. 选择注册方式：
   - 邮箱注册
   - 第三方账号登录（如果有）
3. 填写必要信息
4. 验证邮箱
5. 完成注册
```

#### 步骤3：创建项目

```
1. 登录后进入仪表盘
2. 点击"Create Project"或"新建项目"
3. 填写项目名称和描述
4. 配置项目设置
5. 开始使用
```

### 3.4 Cloud API使用

Cloud版本提供RESTful API，可以与现有系统集成。

#### API基础信息

| 项目 | 值 |
|------|-----|
| **Base URL** | https://api.memu.so |
| **认证方式** | Authorization: Bearer YOUR_API_KEY |
| **API版本** | v3 |

#### 主要API端点

| 方法 | 端点 | 功能描述 |
|------|------|---------|
| `POST` | `/api/v3/memory/memorize` | 注册持续学习任务 |
| `GET` | `/api/v3/memory/memorize/status/{task_id}` | 检查实时处理状态 |
| `POST` | `/api/v3/memory/categories` | 列出自动生成的类别 |
| `POST` | `/api/v3/memory/retrieve` | 查询记忆（支持主动上下文加载） |

#### API使用示例

```python
import requests

# 配置
BASE_URL = "https://api.memu.so"
API_KEY = "your_api_key_here"

headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json"
}

# 创建持续学习任务
response = requests.post(
    f"{BASE_URL}/api/v3/memory/memorize",
    headers=headers,
    json={
        "resource_url": "path/to/conversation.txt",
        "modality": "conversation"
    }
)

print(response.json())

# 查询记忆
response = requests.post(
    f"{BASE_URL}/api/v3/memory/retrieve",
    headers=headers,
    json={
        "queries": [
            {"role": "user", "content": {"text": "用户偏好什么？"}
        ],
        "method": "rag"
    }
)
```

### 3.5 Cloud版本优缺点

#### 优点
- 🚀 **即时可用**：无需安装，立即开始
- 🔧 **零配置**：开箱即用，无需环境配置
- 💰 **有免费额度**：可以免费试用大部分功能
- 🔄 **自动更新**：始终使用最新版本
- 🌐 **随时随地**：任何设备只要有浏览器就能用

#### 缺点
- 🌐 **需要网络**：必须联网才能使用
- 🔒 **数据在云端**：数据安全性依赖服务商
- 💸 **可能收费**：企业功能可能需要付费
- ⚙️ **定制受限**：自定义程度有限

---

## 四、方法二：Self-Hosted版本安装

### 4.1 概述

Self-Hosted版本是memU的本地部署版本，完全运行在自己的机器上，数据完全本地化。

### 4.2 环境要求详解

#### 4.2.1 必需依赖

| 依赖项 | 最低版本 | 推荐版本 | 检查命令 | 状态 |
|--------|---------|---------|---------|------|
| **Python** | 3.13.0 | 3.13.x | `python --version` | 待检查 |
| **pip** | 任意 | 最新版 | `pip --version` | 待检查 |
| **Git** | 任意 | 最新版 | `git --version` | 待检查 |

#### 4.2.2 可选依赖（推荐）

| 依赖项 | 用途 | 推荐版本 | 检查命令 |
|--------|------|---------|---------|
| **uv** | 包管理器 | 最新版 | `uv --version` |
| **Docker Desktop** | 容器化PostgreSQL | 最新版 | `docker --version` |

#### 4.2.3 存储选项

| 存储类型 | 是否必需 | 特点 | 适用场景 |
|---------|---------|------|---------|
| **内存存储** | ✅ 是 | 临时，重启丢失 | 测试、开发 |
| **SQLite** | ❌ 否 | 本地文件，轻量 | 小型项目 |
| **PostgreSQL** | ❌ 否 | 企业级，持久化 | 生产环境 |
| **PostgreSQL+pgvector** | ❌ 否 | 向量搜索 | AI应用 |

### 4.3 系统要求

| 要求 | 最低配置 | 推荐配置 |
|------|---------|---------|
| **操作系统** | Windows 10 | Windows 11 |
| **内存** | 4GB RAM | 8GB RAM+ |
| **磁盘空间** | 500MB | 2GB+ |
| **网络** | 可选 | 用于API调用 |

### 4.4 详细安装步骤

#### 步骤1：检查Python版本

```bash
# 检查当前Python版本
python --version

# 期望输出：
# Python 3.13.x

# 如果版本不足，需要升级Python
```

**Python升级方法**：

**方式A：使用Python官网安装**

```
1. 访问 https://www.python.org/downloads/
2. 下载Python 3.13.x（Windows installer）
3. 运行安装程序
4. 勾选"Add Python to PATH"
5. 完成安装
6. 验证：python --version
```

**方式B：使用winget（推荐）**

```powershell
# 以管理员身份运行PowerShell
winget install Python.Python.3.13
```

**方式C：使用Chocolatey**

```powershell
choco install python313
```

#### 步骤2：安装uv包管理器（推荐）

```bash
# 使用pip安装uv（如果已有Python）
pip install uv

# 或使用curl安装（Linux/macOS）
curl -LsSf https://astral.sh/uv/install.sh | sh

# 验证
uv --version
```

#### 步骤3：克隆memU仓库

```bash
# 克隆memU GitHub仓库
git clone https://github.com/NevaMind-AI/memU.git

# 进入项目目录
cd memU
```

#### 步骤4：安装memU

**方式A：使用pip安装**

```bash
# 标准安装
pip install -e .

# 或指定依赖安装
pip install -e .[all]
```

**方式B：使用uv安装（推荐）**

```bash
# 使用uv安装（更快）
uv pip install -e .
```

#### 步骤5：配置环境变量

```bash
# 设置OpenAI API密钥（必需）
export OPENAI_API_KEY=your_api_key_here

# 或在Windows上
set OPENAI_API_KEY=your_api_key_here
```

**其他可选环境变量**：

```bash
# OpenRouter API密钥（如果使用）
export OPENROUTER_API_KEY=your_openrouter_key

# 自定义API地址（可选）
export OPENAI_BASE_URL=https://your-custom-endpoint.com
```

### 4.5 存储配置选项

#### 4.5.1 内存存储模式（开发测试用）

**特点**：
- 数据存储在内存中
- 重启后数据丢失
- 无需额外配置
- 适合开发和测试

**使用方式**：

```python
from memu import MemoryService

# 使用内存存储
service = MemoryService(
    database_config={
        "metadata_store": {"provider": "inmemory"}
    }
)
```

**运行测试**：

```bash
cd tests
python test_inmemory.py
```

#### 4.5.2 PostgreSQL模式（推荐生产使用）

**特点**：
- 数据持久化存储
- 支持向量搜索（pgvector）
- 适合生产环境
- 需要Docker或独立PostgreSQL

**方式A：使用Docker运行PostgreSQL**

```bash
# 启动PostgreSQL+pgvector容器
docker run -d \
  --name memu-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=memu \
  -p 5432:5432 \
  pgvector/pgvector:pg16

# 验证容器运行状态
docker ps | grep memu-postgres
```

**方式B：使用现有PostgreSQL**

```bash
# 确保PostgreSQL服务器已安装并运行
# 创建数据库
createdb memu

# 安装pgvector扩展
psql -d memu -c "CREATE EXTENSION IF NOT EXISTS vector"
```

**memU配置**：

```python
from memu import MemoryService

service = MemoryService(
    database_config={
        "metadata_store": {
            "provider": "postgres",
            "connection_string": "postgresql://postgres:postgres@localhost:5432/memu"
        },
        "vector_store": {
            "provider": "pgvector",
            "connection_string": "postgresql://postgres:postgres@localhost:5432/memu"
        }
    }
)
```

**运行测试**：

```bash
cd tests
python test_postgres.py
```

### 4.6 自定义LLM和Embedding配置

memU支持使用自定义的LLM和Embedding提供商。

#### 4.6.1 配置示例：阿里云通义千问

```python
from memu import MemUService

service = MemUService(
    llm_profiles={
        # 默认配置
        "default": {
            "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
            "api_key": "your_dashscope_api_key",
            "chat_model": "qwen3-max",
            "client_backend": "sdk"  # 或 "http"
        },
        # 独立的Embedding配置
        "embedding": {
            "base_url": "https://api.voyageai.com/v1",
            "api_key": "your_voyage_api_key",
            "embed_model": "voyage-3.5-lite"
        }
    }
)
```

#### 4.6.2 配置示例：OpenRouter

```python
from memu import MemoryService

service = MemoryService(
    llm_profiles={
        "default": {
            "provider": "openrouter",
            "client_backend": "httpx",
            "base_url": "https://openrouter.ai",
            "api_key": "your_openrouter_api_key",
            "chat_model": "anthropic/claude-3.5-sonnet",
            "embed_model": "openai/text-embedding-3-small"
        }
    },
    database_config={
        "metadata_store": {"provider": "inmemory"}
    }
)
```

#### 4.6.3 环境变量配置

| 环境变量 | 说明 | 是否必需 |
|---------|------|---------|
| `OPENAI_API_KEY` | OpenAI API密钥 | 如果使用OpenAI |
| `OPENROUTER_API_KEY` | OpenRouter API密钥 | 如果使用OpenRouter |
| `DASHSCOPE_API_KEY` | 阿里云API密钥 | 如果使用通义千问 |
| `VOYAGE_API_KEY` | VoyageAI API密钥 | 如果使用Voyage Embeddings |

---

## 五、环境依赖详细检查

### 5.1 已验证的安装依赖

#### Python环境

| 检查项 | 命令 | 期望输出 | 实际状态 |
|--------|------|---------|---------|
| Python版本 | `python --version` | Python 3.13.x | 待验证 |
| pip版本 | `pip --version` | pip xx.x | ✅ 已验证 |
| Python路径 | `where python` | Python安装路径 | ✅ 已验证 |

#### Git环境

| 检查项 | 命令 | 期望输出 | 实际状态 |
|--------|------|---------|---------|
| Git版本 | `git --version` | git version x.x.x | ✅ 已验证 |
| Git配置 | `git config --list` | 用户配置 | ✅ 已验证 |

#### 辅助工具

| 检查项 | 命令 | 期望输出 | 实际状态 |
|--------|------|---------|---------|
| Node.js | `node --version` | vxx.x.x | ✅ 已验证 |
| npm | `npm --version` | xx.x.x | ✅ 已验证 |
| Go | `go version` | go version x.x.x | ✅ 已验证 |

### 5.2 缺失依赖分析

#### 关键缺失

| 依赖项 | 要求版本 | 当前状态 | 升级方案 |
|--------|---------|---------|---------|
| **Python** | ≥ 3.13.0 | ❌ 3.11.9 | 需要升级到3.13 |
| **Docker Desktop** | 最新版 | ❌ 未安装 | 需要安装 |
| **uv** | 推荐 | ❌ 未安装 | 可选安装 |

#### 依赖问题影响

| 缺失项 | 影响程度 | 后果 | 解决方案 |
|--------|---------|------|---------|
| Python < 3.13 | 🔴 严重 | 无法安装memU | 必须升级 |
| Docker Desktop | 🟡 中等 | 无法使用容器化PostgreSQL | 推荐安装 |
| uv | 🟢 轻微 | 安装速度较慢 | 可选安装 |

### 5.3 升级方案

#### 方案A：升级Python到3.13

**风险评估**：
- 兼容性风险：中等（大部分包已支持3.13）
- 回滚难度：低（可以安装多个Python版本）
- 推荐指数：⭐⭐⭐⭐⭐

**升级步骤**：

```powershell
# 方法1：使用winget（推荐）
winget install Python.Python.3.13

# 方法2：手动安装
# 访问 https://www.python.org/downloads/
# 下载 Python 3.13.x Windows installer
# 运行安装程序
# 勾选 "Add Python to PATH"
# 验证：python --version
```

**验证升级**：

```bash
# 检查版本
python --version

# 如果显示3.13则成功
# 如果还是3.11，需要将3.13添加到PATH
```

#### 方案B：安装Docker Desktop

**风险评估**：
- 系统要求：Windows 10 22H2+ 或 Windows 11
- 资源占用：中等（需要后台运行）
- 推荐指数：⭐⭐⭐⭐

**安装步骤**：

```powershell
# 1. 启用WSL2
wsl --install

# 2. 下载Docker Desktop
# 访问 https://www.docker.com/products/docker-desktop/

# 3. 运行安装程序

# 4. 启动Docker Desktop

# 5. 验证安装
docker --version
docker-compose --version
```

---

## 六、详细安装步骤

### 6.1 快速安装流程（30分钟版）

此流程适合已有Python 3.13环境的用户。

#### Phase 1：基础环境（5分钟）

```bash
# 1. 验证Python环境
python --version
# 输出应为：Python 3.13.x

# 2. 克隆仓库
git clone https://github.com/NevaMind-AI/memU.git
cd memU

# 3. 创建虚拟环境（推荐）
python -m venv memu-env
memu-env\Scripts\activate  # Windows
# 或
source memu-env/bin/activate  # Linux/macOS
```

#### Phase 2：安装memU（10分钟）

```bash
# 1. 标准安装
pip install -e .

# 2. 验证安装
python -c "import memu; print('memU installed successfully')"

# 3. 设置API密钥
export OPENAI_API_KEY=your_api_key  # Linux/macOS
# 或
set OPENAI_API_KEY=your_api_key  # Windows
```

#### Phase 3：测试运行（15分钟）

```bash
# 1. 运行内存模式测试
cd tests
python test_inmemory.py

# 2. 查看测试输出
# 期望看到成功的测试结果

# 3. 尝试简单示例
python examples/example_1_conversation_memory.py
```

### 6.2 完整安装流程（2小时版）

此流程适合需要PostgreSQL持久化存储的用户。

#### Phase 1：环境准备（30分钟）

```
任务1.1：升级Python到3.13
任务1.2：安装Docker Desktop
任务1.3：配置WSL2
任务1.4：安装uv包管理器
```

**详细步骤**：

```powershell
# 1. 升级Python
winget install Python.Python.3.13

# 2. 启用WSL2
wsl --install

# 3. 重启计算机

# 4. 安装Docker Desktop
# 下载并运行 Docker Desktop Installer.exe

# 5. 验证Docker
docker run hello-world
```

#### Phase 2：启动PostgreSQL（20分钟）

```bash
# 1. 启动Docker PostgreSQL容器
docker run -d \
  --name memu-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=memu \
  -p 5432:5432 \
  pgvector/pgvector:pg16

# 2. 等待容器启动（约2-3分钟）
docker ps | grep memu-postgres

# 3. 验证PostgreSQL
psql -h localhost -U postgres -c "SELECT version();"
```

#### Phase 3：安装memU（30分钟）

```bash
# 1. 克隆仓库
git clone https://github.com/NevaMind-AI/memU.git
cd memU

# 2. 使用uv安装
pip install uv  # 如果没有uv
uv pip install -e .

# 3. 验证安装
python -c "import memu; print('Success')"
```

#### Phase 4：配置数据库连接（20分钟）

```python
# 创建配置文件 config.py
from memu import MemoryService

service = MemoryService(
    llm_profiles={
        "default": {
            "api_key": "your_openai_api_key",
            "chat_model": "gpt-4"
        }
    },
    database_config={
        "metadata_store": {
            "provider": "postgres",
            "connection_string": "postgresql://postgres:postgres@localhost:5432/memu"
        },
        "vector_store": {
            "provider": "pgvector",
            "connection_string": "postgresql://postgres:postgres@localhost:5432/memu"
        }
    }
)
```

#### Phase 5：测试验证（20分钟）

```bash
# 1. 运行PostgreSQL测试
cd tests
python test_postgres.py

# 2. 查看测试报告
# 期望看到所有测试通过

# 3. 运行完整示例
python examples/example_1_conversation_memory.py
```

### 6.3 安装检查清单

#### 安装前检查

- [ ] Python版本 ≥ 3.13.0
- [ ] pip已安装且可正常工作
- [ ] Git已安装并配置
- [ ] 有有效的API密钥（OpenAI或其他）
- [ ] 磁盘空间 ≥ 500MB

#### 安装中检查

- [ ] 成功克隆仓库
- [ ] 成功创建虚拟环境（推荐）
- [ ] pip install无错误
- [ ] Python导入成功

#### 安装后检查

- [ ] `python -c "import memu; print('OK')"` 成功
- [ ] 测试文件运行无错误
- [ ] API连接正常
- [ ] 记忆功能正常工作

---

## 七、常见问题与解决方案

### 7.1 Python版本问题

#### 问题1：Python版本不足

**错误信息**：
```
ERROR: Package 'memU' requires Python >= 3.13 but your version is 3.11.9
```

**解决方案**：

```powershell
# 方法1：使用pyenv管理多版本
# 安装pyenv
pip install pyenv-win

# 安装Python 3.13
pyenv install 3.13.0

# 切换版本
pyenv local 3.13.0

# 方法2：安装新版本并使用
winget install Python.Python.3.13

# 验证
python --version
```

### 7.2 pip安装问题

#### 问题2：pip安装失败

**错误信息**：
```
ERROR: Could not find a version that satisfies the requirement memU
```

**解决方案**：

```bash
# 方法1：升级pip
pip install --upgrade pip

# 方法2：使用--no-cache-dir
pip install --no-cache-dir -e .

# 方法3：检查网络
ping pypi.org
ping github.com
```

### 7.3 Docker问题

#### 问题3：Docker未安装

**错误信息**：
```
docker: command not found
```

**解决方案**：

```powershell
# 1. 检查Docker Desktop是否安装
# 查看开始菜单是否有Docker Desktop

# 2. 如果未安装，下载安装
# 访问 https://www.docker.com/products/docker-desktop/

# 3. 安装后启动Docker Desktop

# 4. 验证
docker --version
docker-compose --version
```

#### 问题4：Docker容器无法启动

**错误信息**：
```
docker: error response from daemon: driver failed programming external connectivity
```

**解决方案**：

```bash
# 1. 停止Docker Desktop
# 2. 以管理员身份运行PowerShell
# 3. 重启Docker服务
net stop com.docker.service
net start com.docker.service

# 4. 重新启动Docker Desktop
```

### 7.4 API连接问题

#### 问题5：OpenAI API连接失败

**错误信息**：
```
openai.AuthenticationError: Incorrect API key provided
```

**解决方案**：

```bash
# 1. 检查API密钥
echo $OPENAI_API_KEY

# 2. 验证API密钥格式
# 应该以 sk- 开头

# 3. 检查API密钥是否有效
# 访问 https://platform.openai.com/api-keys

# 4. 设置正确的环境变量
export OPENAI_API_KEY="sk-your-actual-api-key"
```

### 7.5 数据库问题

#### 问题6：PostgreSQL连接失败

**错误信息**：
```
could not connect to server: Connection refused
```

**解决方案**：

```bash
# 1. 检查PostgreSQL服务状态
docker ps | grep postgres

# 2. 如果容器未运行，启动它
docker start memu-postgres

# 3. 检查连接字符串
# 确保端口、用户名、密码正确

# 4. 测试连接
psql -h localhost -U postgres -d memu
```

#### 问题7：pgvector扩展未安装

**错误信息**：
```
ERROR: extension "vector" not found
```

**解决方案**：

```sql
-- 连接到数据库后执行
psql -d memu -c "CREATE EXTENSION IF NOT EXISTS vector;"
```

---

## 八、使用方法详解

### 8.1 基本使用流程

#### 8.1.1 初始化服务

```python
from memu import MemoryService

# 使用内存存储
service = MemoryService()

# 或使用PostgreSQL
service = MemoryService(
    database_config={
        "metadata_store": {
            "provider": "postgres",
            "connection_string": "postgresql://user:pass@localhost:5432/memu"
        }
    }
)
```

#### 8.1.2 存储记忆

```python
# 存储对话记忆
result = await service.memorize(
    resource_url="path/to/conversation.txt",
    modality="conversation",
    user={"user_id": "user123"}
)

# 存储文档记忆
result = await service.memorize(
    resource_url="path/to/document.pdf",
    modality="document"
)

# 存储图片记忆
result = await service.memorize(
    resource_url="path/to/image.png",
    modality="image"
)
```

#### 8.1.3 检索记忆

```python
# RAG模式检索（快速）
result = await service.retrieve(
    queries=[
        {"role": "user", "content": {"text": "用户偏好什么？"}}
    ],
    method="rag"
)

# LLM模式检索（深度）
result = await service.retrieve(
    queries=[
        {"role": "user", "content": {"text": "分析用户需求"}}
    ],
    method="llm"
)
```

### 8.2 主动式记忆示例

#### 示例1：持续学习助手

```python
from memu import MemoryService

service = MemoryService()

# 模拟持续学习
async def continuous_learning():
    # 从对话中学习
    await service.memorize(
        resource_url="conversation_001.txt",
        modality="conversation"
    )
    
    # 从文档中学习
    await service.memorize(
        resource_url="specification_001.pdf",
        "document"
    )
    
    # 查询已学习的知识
    result = await service.retrieve(
        queries=[
            {"role": "user", "content": {"text": "用户的学习偏好是什么？"}}
        ],
        method="llm"
    )
    
    print(result)
```

#### 示例2：主动预测Agent

```python
from memu import MemoryService

async def proactive_agent():
    service = MemoryService()
    
    # 监控用户行为
    while True:
        # 获取用户输入
        user_input = get_user_input()
        
        # 学习用户意图
        await service.memorize(
            resource_url=user_input,
            modality="conversation"
        )
        
        # 预测下一步
        prediction = await service.retrieve(
            queries=[
                {"role": "user", "content": {"text": "用户接下来想做什么？"}}
            ],
            method="llm"
        )
        
        # 主动行动
        if prediction.confidence > 0.8:
            take_proactive_action(prediction)
```

### 8.3 完整项目示例

```python
"""
memU完整使用示例
"""
import asyncio
from memu import MemoryService


async def main():
    # 1. 初始化服务
    print("初始化memU服务...")
    service = MemoryService(
        llm_profiles={
            "default": {
                "api_key": "your-api-key"
            }
        }
    )
    
    # 2. 学习用户信息
    print("学习用户信息...")
    await service.memorize(
        resource_url="用户是一名软件工程师，擅长Python开发",
        modality="conversation",
        user={"user_id": "engineer_001"}
    )
    
    await service.memorize(
        resource_url="用户喜欢咖啡，每天早上需要喝一杯",
        modality="conversation",
        user={"user_id": "engineer_001"}
    )
    
    # 3. 查询用户偏好
    print("查询用户偏好...")
    result = await service.retrieve(
        queries=[
            {"role": "user", "content": {"text": "这个用户有什么偏好和习惯？"}}
        ],
        where={"user_id": "engineer_001"},
        method="llm"
    )
    
    # 4. 输出结果
    print("\n查询结果：")
    print(result.get("text", "无结果"))
    
    # 5. 主动预测
    print("\n主动预测用户需求...")
    prediction = await service.retrieve(
        queries=[
            {"role": "user", "content": {"text": "这个用户接下来可能需要什么帮助？"}}
        ],
        where={"user_id": "engineer_001"},
        method="llm"
    )
    
    print("\n预测结果：")
    print(prediction.get("next_step_query", "无法预测"))


if __name__ == "__main__":
    asyncio.run(main())
```

---

## 九、性能与配置

### 9.1 性能基准

memU在Locomo基准测试中达到**92.09%平均准确率**，覆盖所有推理任务类型。

### 9.2 配置优化建议

#### 内存优化

```python
# 对于资源有限的环境
service = MemoryService(
    max_memory_items=1000,  # 限制记忆项数量
    cache_size="100MB",     # 限制缓存大小
    cleanup_interval=3600   # 定期清理（秒）
)
```

#### 速度优化

```python
# 对于需要高速响应的场景
service = MemoryService(
    retrieval_method="rag",  # 使用RAG模式更快
    max_results=10,          # 限制返回结果数量
    similarity_threshold=0.8  # 提高相似度阈值
)
```

### 9.3 监控与日志

```python
import logging

# 启用日志
logging.basicConfig(level=logging.INFO)

# 监控服务状态
print(f"服务状态: {service.status()}")
print(f"记忆项数量: {service.count()}")
print(f"缓存使用: {service.cache_usage()}")
```

---

## 十、总结与建议

### 10.1 安装方案选择

| 场景 | 推荐方案 | 理由 |
|------|---------|------|
| **快速体验** | Cloud版本 | 无需安装，立即使用 |
| **日常开发** | Self-Hosted + 内存存储 | 本地可控，速度快 |
| **生产部署** | Self-Hosted + PostgreSQL | 稳定可靠，数据持久化 |
| **学习研究** | Cloud版本 | 简单直接 |
| **集成到产品** | Self-Hosted + PostgreSQL | 完全可控 |

### 10.2 推荐的最小可行配置

**开发环境**：
- Python 3.13
- 内存存储模式
- OpenAI API

**生产环境**：
- Python 3.13
- PostgreSQL + pgvector
- 自定义LLM配置
- 完整的日志和监控

### 10.3 后续步骤

1. ✅ 已有环境检查报告
2. ⏳ 升级Python到3.13（待执行）
3. ⏳ 选择安装方案
4. ⏳ 执行安装
5. ⏳ 运行测试验证
6. ⏳ 集成到项目

---

## 附录

### 附录A：命令速查表

| 命令 | 说明 |
|------|------|
| `python --version` | 检查Python版本 |
| `pip install -e .` | 安装memU |
| `python test_inmemory.py` | 运行内存模式测试 |
| `python test_postgres.py` | 运行PostgreSQL测试 |
| `docker run -d --name memu-postgres ...` | 启动PostgreSQL容器 |

### 附录B：文件路径参考

| 路径 | 说明 |
|------|------|
| `memU/` | memU主目录 |
| `memU/tests/` | 测试文件 |
| `memU/examples/` | 示例代码 |
| `memU/memu/` | memU核心代码 |

### 附录C：API端点速查

| 端点 | 方法 | 功能 |
|------|------|------|
| `/api/v3/memory/memorize` | POST | 创建记忆 |
| `/api/v3/memory/retrieve` | POST | 检索记忆 |
| `/api/v3/memory/categories` | POST | 获取类别 |

### 附录D：参考资料

| 资源 | 链接 |
|------|------|
| **官方文档** | https://memu.pro/docs |
| **GitHub仓库** | https://github.com/NevaMind-AI/memU |
| **API参考** | https://memu.pro/docs#cloud-version |
| **Discord社区** | https://discord.gg/memu |
| **性能基准** | https://github.com/NevaMind-AI/memU-experiment |

---

**文档更新时间**: 2026-02-05 10:53:49  
**版本**: v1.0  
**研究人**: OpenCode AI Assistant

---

**文档结束**
