# 阶段1.1：基础架构搭建 - 设计文档

**文档编号**: OMA-DESIGN-1.1  
**版本**: v1.0  
**创建时间**: 2026-02-15 22:52:00  
**阶段状态**: 待启动  
**关联文档**: 开发策略规范-v2.0、开发优先级计划

---

## 1. 阶段目标

### 1.1 要实现的功能
搭建Web端基础架构，实现前后端通信框架，为后续AI模型接入和ReAct执行器提供基础。

### 1.2 解决的问题
- 建立稳定的前后端通信机制
- 搭建可扩展的项目结构
- 配置开发环境支持热更新和调试

### 1.3 预期效果
- 前后端能正常通信
- 健康检查接口可用
- 开发环境配置完成

---

## 2. 技术方案

### 2.1 架构设计

```
┌─────────────────────────────────────────┐
│           前端 (React + Vite)            │
│  ┌─────────────┐    ┌─────────────┐     │
│  │  React组件  │◄──►│  Axios请求  │     │
│  └─────────────┘    └──────┬──────┘     │
└─────────────────────────────┼───────────┘
                              │ HTTP
┌─────────────────────────────┼───────────┐
│      后端 (FastAPI)         │           │
│  ┌─────────────┐    ┌───────▼──────┐    │
│  │  API路由    │◄──►│ CORS中间件   │    │
│  └──────┬──────┘    └──────────────┘    │
│         │                               │
│  ┌──────▼──────┐                       │
│  │ 健康检查接口 │                       │
│  └─────────────┘                       │
└─────────────────────────────────────────┘
```

### 2.2 关键技术选型

| 组件 | 技术 | 版本 | 选择理由 |
|------|------|------|---------|
| 前端框架 | React | ^18.0 | 生态成熟，组件化开发 |
| 构建工具 | Vite | ^5.0 | 快速热更新，现代ESM |
| UI组件库 | Ant Design | ^5.0 | 企业级组件，文档完善 |
| HTTP客户端 | Axios | ^1.6 | 拦截器支持，错误处理 |
| 后端框架 | FastAPI | ^0.109 | 异步支持，自动文档 |
| Python | Python | 3.11+ | 类型注解，性能优化 |

### 2.3 接口定义

#### 2.3.1 健康检查接口

```yaml
GET /api/health

Request:
  - 无参数

Response (200 OK):
  {
    "status": "ok",
    "timestamp": "2026-02-15T22:52:00Z",
    "version": "0.1.0"
  }
```

#### 2.3.2 测试通信接口

```yaml
POST /api/echo

Request:
  {
    "message": "string"
  }

Response (200 OK):
  {
    "received": "string",
    "timestamp": "2026-02-15T22:52:00Z"
  }
```

### 2.4 项目结构

```
omniagent/
├── backend/                 # Python后端
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py         # FastAPI入口
│   │   └── api/
│   │       └── v1/
│   │           └── health.py
│   ├── requirements.txt
│   └── pyproject.toml
│
└── frontend/               # React前端
    ├── src/
    │   ├── components/
    │   │   └── HealthCheck/
    │   ├── services/
    │   │   └── api.ts
    │   ├── App.tsx
    │   └── main.tsx
    ├── package.json
    └── vite.config.ts
```

---

## 3. 验收标准（可验证！）

### 3.1 后端验收

- [ ] **AC001**: 能启动FastAPI服务，监听8000端口
  - 验证方法: `python -m uvicorn app.main:app --reload`
  - 通过标准: 服务启动无报错，控制台显示"Application startup complete"

- [ ] **AC002**: 健康检查接口返回正常
  - 验证方法: `curl http://localhost:8000/api/health`
  - 通过标准: 返回JSON包含status="ok"

- [ ] **AC003**: CORS配置正确，允许前端跨域访问
  - 验证方法: 前端能成功调用后端接口
  - 通过标准: 无CORS错误

### 3.2 前端验收

- [ ] **AC004**: React项目能正常启动
  - 验证方法: `npm run dev`
  - 通过标准: 浏览器能打开页面，显示React欢迎界面

- [ ] **AC005**: 前端能调用后端健康检查接口
  - 验证方法: 页面显示后端健康状态
  - 通过标准: 显示"后端状态: 正常"

- [ ] **AC006**: 热更新功能正常
  - 验证方法: 修改前端代码，浏览器自动刷新
  - 通过标准: 修改后页面自动更新

### 3.3 集成验收

- [ ] **AC007**: 前后端能端到端通信
  - 验证方法: 前端发送测试消息，后端返回确认
  - 通过标准: 消息能正确发送和接收

---

## 4. 风险与应对

| 风险 | 可能性 | 影响 | 应对方案 |
|------|--------|------|---------|
| Python版本不兼容 | 中 | 高 | 使用pyenv管理Python 3.11环境 |
| Node.js依赖冲突 | 中 | 中 | 使用pnpm锁定依赖版本 |
| CORS配置错误 | 高 | 中 | 按FastAPI官方文档配置，本地开发允许所有来源 |
| 端口冲突 | 低 | 低 | 配置文件中支持自定义端口 |

---

## 5. 参考资料

- [开发策略规范-v2.0](../doc/开发策略规范-v2.0.md) - 第11.1节
- [开发优先级计划](../doc/开发优先级计划.md) - 第1.1节
- FastAPI文档: https://fastapi.tiangolo.com/
- Vite文档: https://vitejs.dev/

---

## 6. 设计评审记录

### 评审人
- [ ] 用户确认

### 评审意见
（待填写）

### 批准状态
- [ ] 批准（可以开始编码）
- [ ] 有条件批准（需修改后重新评审）
- [ ] 不批准（需重新设计）

**批准人**: _______________  
**批准日期**: _______________

---

**重要提示**: 本设计文档必须经用户批准后，才能开始阶段1.1的编码工作。详见[开发策略规范-v2.0](../doc/开发策略规范-v2.0.md)第2章。
