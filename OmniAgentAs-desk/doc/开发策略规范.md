# OmniAgentAst. 开发策略规范

**文档编号**: OMA-DEV-001  
**版本**: v1.0  
**创建时间**: 2026-02-15 22:05:53  
**适用范围**: OmniAgentAst. 桌面版项目全生命周期  
**制定原则**: 质量优先，稳扎稳打，杜绝"快但烂"  
**经验来源**: 整合《代码迭代规范》《代码检查方法》《风险分析》《版本管理》《Git规范》《备份规则》

---

## 1. 核心理念

### 1.1 开发铁律（必须遵守）

| 优先级 | 铁律 | 违反后果 | 经验来源 |
|--------|------|---------|---------|
| **P0** | **质量 > 速度** | 宁可慢，不可用 | 代码迭代规范 |
| **P0** | **测试先行** | 无测试 = 未完成 | 代码迭代规范 |
| **P0** | **阶段锁定** | 前一阶段未验收，绝不开始下一阶段 | 代码迭代规范 |
| **P0** | **先分析，再动手** | 设计文档批准后才能编码 | 代码迭代规范 |
| **P1** | **闭环整改** | 发现问题必须修复验证 | 代码检查方法 |
| **P1** | **用户验收** | 每个阶段必须用户确认可用 | 实践经验 |
| **P2** | **渐进累加** | 每个阶段输出是可验证的增量 | 代码迭代规范 |

### 1.2 失败案例警示

> **反面教材**: "AI七里哐啷开发完成，结果啥都不能用"
> 
> **根本原因**:
> 1. 追求速度，忽视质量（违反"质量>速度"）
> 2. 缺少测试，问题累积（违反"测试先行"）
> 3. 阶段跳跃，基础不牢（违反"阶段锁定"）
> 4. 没有Review，代码失控（违反"闭环整改"）
> 5. 先编码后补文档（违反"先分析再动手"）
> 
> **本规范目标**: 杜绝此类情况再次发生

---

## 2. 阶段开发流程（精简版）

### 2.1 阶段生命周期（9步流程，缺一不可）

```
┌─────────────────────────────────────────────────────────────┐
│                    阶段 N 开发流程                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 阶段启动                                                 │
│     ├─ 确认前一阶段已锁定（Git标签已打）                      │
│     ├─ 创建阶段分支（phase/阶段号）                          │
│     └─ 确认工作区干净（无未提交修改）                         │
│                        ↓                                    │
│  2. 设计文档编写 （必须先分析！）                             │
│     ├─ 阶段目标描述                                          │
│     ├─ 技术方案设计                                          │
│     ├─ 验收标准清单（可验证的！）                             │
│     └─ 用户批准后才能进入下一步                               │
│                        ↓                                    │
│  3. 功能开发（边开发边测试）                                  │
│     ├─ 编写功能代码                                          │
│     ├─ 同步编写单元测试（测试先行）                           │
│     └─ 代码规范检查（ESLint/Pylint通过）                      │
│                        ↓                                    │
│  4. 测试验证                                                │
│     ├─ 运行单元测试（100%通过）                               │
│     ├─ 边界情况测试（null、空值、极值）                       │
│     └─ 生成测试报告（覆盖率≥80%）                            │
│                        ↓                                    │
│  5. 代码审查（闭环整改！）                                    │
│     ├─ 逻辑正确性检查（功能是否符合设计）                     │
│     ├─ 代码质量检查（命名、注释、结构）                       │
│     ├─ 风险分析（边界、异常、安全）                          │
│     ├─ 发现问题 → 修复 → 验证（闭环）                        │
│     └─ 生成审查记录                                          │
│                        ↓                                    │
│  6. 阶段总结                                                │
│     ├─ 完成功能清单                                          │
│     ├─ 问题与解决方案                                        │
│     └─ 待改进项                                              │
│                        ↓                                    │
│  7. 用户验收（最关键！）                                      │
│     ├─ 演示阶段成果                                          │
│     ├─ 用户实际使用测试                                      │
│     └─ 确认验收或打回修改                                    │
│                        ↓                                    │
│  8. 阶段锁定（版本号管理）                                    │
│     ├─ 按语义化版本打Git标签（v0.X.0-phaseN）                 │
│     ├─ 归档阶段文档                                          │
│     └─ 禁止修改（如需修改走补丁流程）                         │
│                        ↓                                    │
│  9. 进入下一阶段                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 关键检查点（不能跳过）

| 检查点 | 检查内容 | 不通过后果 |
|--------|---------|-----------|
| **设计批准** | 设计文档用户批准 | 不能开始编码 |
| **测试通过** | 单元测试100%通过 | 不能进入审查 |
| **闭环整改** | 审查问题全部修复 | 不能进入总结 |
| **用户验收** | 用户确认可用 | 不能锁定阶段 |

---

## 3. 文档规范（3个必须文档）

每个阶段必须产出以下3个文档，缺一不可：

### 3.1 阶段设计文档（编码前）

**文件名**: `阶段X-设计文档-YYYY-MM-DD.md`

```markdown
# 阶段X：阶段名称 - 设计文档

## 1. 阶段目标
- 要实现什么功能
- 预期效果

## 2. 技术方案
- 架构设计
- 接口定义

## 3. 验收标准（必须可验证！）
- [ ] 验收项1：具体描述 + 验证方法
- [ ] 验收项2：具体描述 + 验证方法

## 4. 风险预估
- 可能遇到的问题
- 应对方案
```

### 3.2 测试报告（测试后）

**文件名**: `阶段X-测试报告-YYYY-MM-DD.md`

```markdown
# 阶段X：阶段名称 - 测试报告

## 1. 测试统计
- 总用例数：X
- 通过率：Y/X (100%才能通过)
- 覆盖率：XX% (≥80%)

## 2. 测试用例清单
| 用例ID | 描述 | 类型 | 状态 |
|--------|------|------|------|
| TC001 | ... | 单元测试 | ✅通过 |
| TC002 | ... | 边界测试 | ❌失败 |

## 3. 问题清单
- 发现的问题及修复状态
```

### 3.3 阶段总结（验收前）

**文件名**: `阶段X-阶段总结-YYYY-MM-DD.md`

```markdown
# 阶段X：阶段名称 - 阶段总结

## 1. 完成情况
- 计划：X项 / 完成：Y项 / 未完成：Z项

## 2. 问题记录
- 遇到的问题及解决方法

## 3. 待改进项
- 已知缺陷和优化建议
```

---

## 4. 测试规范

### 4.1 必须测试的内容

- [ ] 正常路径（Happy Path）
- [ ] 边界值（最小值、最大值、空值）
- [ ] 异常输入（null、undefined、类型错误）
- [ ] 错误处理（异常抛出、错误码）

### 4.2 覆盖率要求

| 阶段 | 语句覆盖率 | 分支覆盖率 |
|------|-----------|-----------|
| MVP阶段 | ≥80% | ≥70% |
| 增强阶段 | ≥85% | ≥75% |

### 4.3 测试代码规范

**测试文件命名**:
- 前端: `ComponentName.test.tsx`
- 后端: `test_*.py`

**测试结构（Arrange-Act-Assert）**:
```python
def test_function():
    # Arrange（准备）
    input_data = ...
    expected = ...
    
    # Act（执行）
    result = function(input_data)
    
    # Assert（断言）
    assert result == expected
```

---

## 5. 代码审查规范（整合检查+风险分析）

### 5.1 审查清单（4个维度）

#### 维度1：逻辑正确性
- [ ] 功能是否符合设计文档
- [ ] 边界情况是否处理
- [ ] 错误处理是否完善

#### 维度2：代码质量
- [ ] 命名是否清晰
- [ ] 是否有适当注释
- [ ] 是否符合代码规范（ESLint/Pylint）
- [ ] 是否有重复代码

#### 维度3：风险分析（简化六步法）
- [ ] 边界条件：null、空值、极值测试了吗？
- [ ] 异常情况：网络错误、权限不足处理了吗？
- [ ] 安全隐患：输入验证、XSS防护做了吗？
- [ ] 性能问题：有明显性能瓶颈吗？

#### 维度4：完整性
- [ ] 是否同步编写了单元测试
- [ ] 测试覆盖率是否达标
- [ ] 文档是否更新

### 5.2 闭环整改流程

```
发现问题
    ↓
记录问题（审查记录）
    ↓
修复问题
    ↓
验证修复（测试+审查）
    ↓
确认解决
    ↓
阶段才能继续
```

**规则**: 发现问题必须修复，不能遗留到下一阶段。

---

## 6. 版本号与Git管理（整合版本规范+Git规范+备份规则）

### 6.1 语义化版本号

```
版本号 = MAJOR.MINOR.PATCH
         主版本.次版本.修订版本
```

| 版本位 | 变更场景 | 决策权限 | 阶段对应 |
|--------|----------|----------|---------|
| **MAJOR** | 重大架构变更 | 必须用户指令 | 项目里程碑（v1.0.0） |
| **MINOR** | 新功能模块 | 必须用户同意 | 大阶段完成（v0.1.0） |
| **PATCH** | Bug修复 | 可自主决定 | 阶段内补丁（v0.1.1） |

### 6.2 Git分支策略

| 分支类型 | 命名格式 | 用途 |
|---------|---------|------|
| **主线** | `main` | 稳定版本 |
| **阶段** | `phase/X.Y` | 阶段开发（如 `phase/1.1`） |
| **补丁** | `hotfix/描述` | 已锁定阶段紧急修复 |

**阶段操作流程**:
```bash
# 1. 阶段开始
git checkout -b phase/1.1 main

# 2. 阶段开发（多次commit）

# 3. 阶段完成
git checkout main
git merge phase/1.1
git tag -a v0.1.0-phase1.1 -m "阶段1.1完成"
git push origin v0.1.0-phase1.1
```

### 6.3 阶段锁定条件（必须全部满足）

1. ✅ 设计文档已归档
2. ✅ 测试报告（100%通过，覆盖率≥80%）
3. ✅ 审查记录（闭环整改完成）
4. ✅ 阶段总结已完成
5. ✅ **用户验收已通过**

**锁定后规则**:
- ❌ 严禁修改已锁定代码
- ❌ 严禁新增功能
- ✅ 如需修改走补丁流程

### 6.4 补丁流程（发现严重bug必须修复）

```
1. 用户批准修复
2. 创建补丁分支：git checkout -b hotfix/描述 v0.X.0-phaseN
3. 修复 + 补充测试
4. 审查 + 用户验收
5. 合并 + 新标签：v0.X.1-phaseN（PATCH+1）
```

---

## 7. 违规处理

### 7.1 违规行为及处理

| 违规行为 | 处理措施 |
|---------|---------|
| **跳阶段开发** | 立即停止，回退到上一阶段 |
| **无设计文档编码** | 暂停开发，补全文档 |
| **无测试提交** | 拒绝合并，补充测试 |
| **审查问题不修复** | 阶段不通过，强制修复 |
| **用户未验收就锁定** | 解锁，重新验收 |
| **修改已锁定代码** | 回滚，走补丁流程 |

### 7.2 违规记录

**文件名**: `违规记录-YYYY-MM-DD.md`

记录内容：违规描述、处理措施、预防措施、用户确认。

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| **阶段** | 有明确目标、可验收的独立开发单元 |
| **闭环整改** | 发现问题→修复→验证→解决 |
| **锁定** | 阶段完成并归档，禁止修改 |
| **补丁** | 对已锁定阶段的紧急修复 |

### 8.2 经验来源文档

- 《软件代码迭代规范》- 不求快只求稳，先分析再动手
- 《代码检查方法》- 闭环整改，代码审查维度
- 《代码风险分析方法》- 六步分析法（简化整合到审查）
- 《版本号变更规范》- 语义化版本，分级授权
- 《git使用规范》- 分支策略
- 《软件迭代代码备份规则》- 备份时机

### 8.3 修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|---------|
| v1.0 | 2026-02-15 | AI助手小欧 | 初始版本，整合6份历史经验文档，精简流程，确保每个环节必须 |

---

**文档结束**

**重要提醒**: 
- 本文档共8章，已整合所有历史经验
- 流程精简为9步，每个环节都必须执行
- 3个文档必须产出，4个维度必须审查
- 闭环整改是核心，问题必须修复

**用户确认**:
- [ ] 已阅读全文（第1-8章）
- [ ] 理解流程精简但完整
- [ ] 理解每个环节都必须执行
- [ ] 确认按此规范执行开发

**确认人**: _______________  
**确认日期**: YYYY-MM-DD
