# Phase 1.3: ReAct æ‰§è¡Œå™¨å®ç° - è®¾è®¡æ–‡æ¡£

**æ–‡æ¡£ç¼–å·**: OMA-DESIGN-103  
**é˜¶æ®µ**: 1.3  
**é˜¶æ®µåç§°**: ReAct æ‰§è¡Œå™¨å®ç°ï¼ˆæ ¸å¿ƒï¼‰  
**åˆ›å»ºæ—¶é—´**: 2026-02-16 09:17:14  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.2  
**è®¾è®¡çŠ¶æ€**: ğŸŸ¡ å¾…æ‰¹å‡†  

---

## 1. é˜¶æ®µç›®æ ‡

### 1.1 æ€»ä½“ç›®æ ‡
å®ç° OmniAgentAst çš„æ ¸å¿ƒæ™ºèƒ½æ‰§è¡Œå¼•æ“â€”â€”**ReAct (Reasoning + Acting) å¾ªç¯**ï¼Œä½¿ Agent å…·å¤‡è‡ªä¸»æ€è€ƒå’Œæ‰§è¡Œèƒ½åŠ›ã€‚

### 1.2 å…·ä½“ç›®æ ‡
1. **å·¥å…·æ¡†æ¶**: å»ºç«‹å¯æ‰©å±•çš„å·¥å…·å®šä¹‰å’Œæ³¨å†Œæœºåˆ¶
2. **P0 å·¥å…·é›†**: å®ç° 4 ä¸ªåŸºç¡€æ–‡ä»¶æ“ä½œå·¥å…·
3. **ReAct å¾ªç¯**: å®ç° æ€è€ƒâ†’è¡ŒåŠ¨â†’è§‚å¯Ÿ çš„å®Œæ•´é—­ç¯
4. **é”™è¯¯æ¢å¤**: å®ç° 3 æ¬¡é‡è¯•æœºåˆ¶å’ŒåŸºç¡€é”™è¯¯å¤„ç†

### 1.3 ä¸ Phase 1.2 çš„å…³ç³»
```
Phase 1.2 (AIæ¨¡å‹æ¥å…¥) â†’ Phase 1.3 (ReActæ‰§è¡Œå™¨) â†’ Phase 1.4 (å¯¹è¯ç•Œé¢)
      æä¾›AIèƒ½åŠ›            å®ç°æ™ºèƒ½æ‰§è¡Œ               æä¾›ç”¨æˆ·äº¤äº’
```

---

## 2. æŠ€æœ¯æ–¹æ¡ˆ

### 2.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ReAct æ‰§è¡Œå™¨æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Thought   â”‚ --> â”‚   Action    â”‚ --> â”‚Observation â”‚   â”‚
â”‚  â”‚   (æ€è€ƒ)    â”‚     â”‚   (è¡ŒåŠ¨)    â”‚     â”‚  (è§‚å¯Ÿ)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†‘                                            â”‚      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          (åé¦ˆå¾ªç¯)                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å·¥å…·å±‚ (Tool Layer)               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚read_file â”‚ â”‚write_fileâ”‚ â”‚list_dir  â”‚ â”‚move_file â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

#### 2.2.1 å·¥å…·å®šä¹‰ Schema

æ¯ä¸ªå·¥å…·å¿…é¡»éµå¾ªä»¥ä¸‹ Schemaï¼š

```python
{
    "name": "å·¥å…·åç§°",                    # å¿…é¡»æ˜¯è‹±æ–‡ï¼Œä¸‹åˆ’çº¿åˆ†éš”
    "description": "åŠŸèƒ½æè¿°",              # ç»™ AI çœ‹çš„æè¿°
    "parameters": {
        "param1": {
            "type": "string",              # å‚æ•°ç±»å‹
            "description": "å‚æ•°æè¿°",      # å‚æ•°è¯´æ˜
            "required": True,              # æ˜¯å¦å¿…éœ€
            "default": None                # é»˜è®¤å€¼
        }
    },
    "returns": {
        "type": "object",
        "description": "è¿”å›ç»“æœè¯´æ˜"
    },
    "danger_level": "low|medium|high",     # é£é™©ç­‰çº§
    "examples": [                          # ä½¿ç”¨ç¤ºä¾‹
        {
            "input": {"path": "/tmp/test.txt"},
            "output": {"content": "æ–‡ä»¶å†…å®¹...", "success": True}
        }
    ]
}
```

#### 2.2.2 å·¥å…·åŸºç±»è®¾è®¡

```python
# app/tools/base.py
from abc import ABC, abstractmethod
from typing import Any, Dict, Optional
from pydantic import BaseModel, Field

class ToolParameter(BaseModel):
    """å·¥å…·å‚æ•°å®šä¹‰"""
    type: str
    description: str
    required: bool = True
    default: Optional[Any] = None

class ToolDefinition(BaseModel):
    """å·¥å…·å®šä¹‰Schema"""
    name: str
    description: str
    parameters: Dict[str, ToolParameter]
    returns: Dict[str, Any]
    danger_level: str = "low"  # low, medium, high
    examples: list = []

class ToolResult(BaseModel):
    """å·¥å…·æ‰§è¡Œç»“æœ"""
    success: bool
    data: Optional[Any] = None
    error: Optional[str] = None
    execution_time: float = 0.0

class BaseTool(ABC):
    """å·¥å…·åŸºç±»"""
    
    def __init__(self):
        self.definition = self._get_definition()
    
    @abstractmethod
    def _get_definition(self) -> ToolDefinition:
        """è¿”å›å·¥å…·å®šä¹‰"""
        pass
    
    @abstractmethod
    async def execute(self, **kwargs) -> ToolResult:
        """æ‰§è¡Œå·¥å…·"""
        pass
    
    def validate_params(self, params: Dict[str, Any]) -> bool:
        """éªŒè¯å‚æ•°æ˜¯å¦åˆæ³•"""
        # æ£€æŸ¥å¿…éœ€å‚æ•°
        for name, param in self.definition.parameters.items():
            if param.required and name not in params:
                return False
        return True
```

#### 2.2.3 P0 å·¥å…·å®ç°æ¸…å•

| å·¥å…· | åŠŸèƒ½ | é£é™©ç­‰çº§ | å…³é”®å‚æ•° | è¿”å›å€¼ |
|------|------|---------|---------|--------|
| **read_file** | è¯»å–æ–‡ä»¶å†…å®¹ | ğŸŸ¢ low | path: æ–‡ä»¶è·¯å¾„ | content: æ–‡ä»¶å†…å®¹ |
| **write_file** | å†™å…¥/åˆ›å»ºæ–‡ä»¶ | ğŸŸ¡ medium | path, content, mode | success: æ˜¯å¦æˆåŠŸ |
| **list_directory** | åˆ—å‡ºç›®å½•å†…å®¹ | ğŸŸ¢ low | path, recursive | files: æ–‡ä»¶åˆ—è¡¨ |
| **move_file** | ç§»åŠ¨/é‡å‘½å | ğŸŸ¡ medium | source, destination | success: æ˜¯å¦æˆåŠŸ |

#### 2.2.4 ReAct å¾ªç¯æ ¸å¿ƒ

```python
# app/core/react_executor.py
from typing import List, Dict, Any, Optional
import json

class ReActExecutor:
    """ReAct æ‰§è¡Œå™¨ï¼šæ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯"""
    
    def __init__(self, ai_service, tool_registry):
        self.ai = ai_service
        self.tools = tool_registry
        self.max_iterations = 10  # æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé˜²æ­¢æ­»å¾ªç¯
        self.retry_attempts = 3   # é”™è¯¯é‡è¯•æ¬¡æ•°
    
    async def execute(self, user_input: str, history: List[Dict] = None) -> Dict[str, Any]:
        """
        æ‰§è¡Œ ReAct å¾ªç¯
        
        Args:
            user_input: ç”¨æˆ·è¾“å…¥
            history: å†å²æ¶ˆæ¯
            
        Returns:
            æ‰§è¡Œç»“æœ
        """
        iterations = 0
        context = {
            "user_input": user_input,
            "thoughts": [],
            "actions": [],
            "observations": []
        }
        
        while iterations < self.max_iterations:
            iterations += 1
            
            # Step 1: Thought (æ€è€ƒ)
            thought = await self._think(context, history)
            context["thoughts"].append(thought)
            
            # æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»“æŸ
            if thought.get("should_stop", False):
                return {
                    "success": True,
                    "answer": thought.get("answer", ""),
                    "context": context
                }
            
            # Step 2: Action (è¡ŒåŠ¨)
            action = thought.get("action")
            if not action:
                continue
                
            context["actions"].append(action)
            
            # Step 3: Observation (è§‚å¯Ÿ)
            observation = await self._act(action)
            context["observations"].append(observation)
            
            # å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå°è¯•é‡è¯•
            if not observation.get("success", False):
                for attempt in range(self.retry_attempts):
                    retry_observation = await self._retry_action(action, observation, attempt)
                    if retry_observation.get("success", False):
                        observation = retry_observation
                        break
        
        # è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå¼ºåˆ¶ç»“æŸ
        return {
            "success": False,
            "error": "è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°",
            "context": context
        }
    
    async def _think(self, context: Dict, history: List[Dict]) -> Dict:
        """
        æ€è€ƒé˜¶æ®µï¼šè°ƒç”¨ AI å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
        
        è¿”å›æ ¼å¼ï¼š
        {
            "thought": "æ€è€ƒè¿‡ç¨‹...",
            "action": {"tool": "tool_name", "params": {...}},
            "should_stop": false,
            "answer": ""  # åªæœ‰åœ¨ should_stop=true æ—¶æ‰æœ‰å€¼
        }
        """
        # æ„å»º prompt
        prompt = self._build_think_prompt(context, history)
        
        # è°ƒç”¨ AI
        response = await self.ai.chat(prompt)
        
        # è§£æå“åº”
        return self._parse_thought_response(response)
    
    async def _act(self, action: Dict) -> Dict:
        """
        è¡ŒåŠ¨é˜¶æ®µï¼šæ‰§è¡Œå·¥å…·
        
        Args:
            action: {"tool": "tool_name", "params": {...}}
        """
        tool_name = action.get("tool")
        params = action.get("params", {})
        
        # æŸ¥æ‰¾å·¥å…·
        tool = self.tools.get(tool_name)
        if not tool:
            return {
                "success": False,
                "error": f"æœªçŸ¥å·¥å…·: {tool_name}"
            }
        
        # æ‰§è¡Œå·¥å…·
        try:
            result = await tool.execute(**params)
            return {
                "success": result.success,
                "data": result.data,
                "error": result.error
            }
        except Exception as e:
            return {
                "success": False,
                "error": str(e)
            }
    
    async def _retry_action(self, action: Dict, last_error: Dict, attempt: int) -> Dict:
        """é‡è¯•å¤±è´¥çš„è¡ŒåŠ¨"""
        # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é‡è¯•é€»è¾‘ï¼Œæ¯”å¦‚ä¿®æ”¹å‚æ•°ã€æ¢ç”¨å…¶ä»–å·¥å…·ç­‰
        return await self._act(action)
    
    def _build_think_prompt(self, context: Dict, history: List[Dict]) -> str:
        """æ„å»ºæ€è€ƒé˜¶æ®µçš„ prompt"""
        tools_desc = self.tools.get_tools_description()
        
        prompt = f"""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·è¾“å…¥å’Œä¸Šä¸‹æ–‡å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‚

å¯ç”¨å·¥å…·ï¼š
{tools_desc}

ç”¨æˆ·è¾“å…¥ï¼š{context['user_input']}

å†å²æ€è€ƒï¼š
{self._format_thoughts(context['thoughts'])}

å†å²è¡ŒåŠ¨ï¼š
{self._format_actions(context['actions'])}

å†å²è§‚å¯Ÿï¼š
{self._format_observations(context['observations'])}

è¯·å†³å®šä¸‹ä¸€æ­¥ï¼š
1. å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œè¾“å‡ºæœ€ç»ˆç­”æ¡ˆ
2. å¦‚æœéœ€è¦ä½¿ç”¨å·¥å…·ï¼Œè¾“å‡ºå·¥å…·è°ƒç”¨

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å“åº”ï¼š
{{
    "thought": "ä½ çš„æ€è€ƒè¿‡ç¨‹",
    "action": {{"tool": "å·¥å…·å", "params": {{"å‚æ•°å": "å‚æ•°å€¼"}}}},
    "should_stop": false,
    "answer": ""
}}
"""
        return prompt
```

### 2.3 å·¥å…·æ³¨å†Œæœºåˆ¶

```python
# app/tools/registry.py
from typing import Dict, Type
from .base import BaseTool

class ToolRegistry:
    """å·¥å…·æ³¨å†Œè¡¨"""
    
    _tools: Dict[str, BaseTool] = {}
    
    @classmethod
    def register(cls, tool_instance: BaseTool):
        """æ³¨å†Œå·¥å…·"""
        name = tool_instance.definition.name
        cls._tools[name] = tool_instance
        print(f"[ToolRegistry] æ³¨å†Œå·¥å…·: {name}")
    
    @classmethod
    def get(cls, name: str) -> BaseTool:
        """è·å–å·¥å…·"""
        return cls._tools.get(name)
    
    @classmethod
    def list_tools(cls) -> list:
        """åˆ—å‡ºæ‰€æœ‰å·¥å…·"""
        return list(cls._tools.keys())
    
    @classmethod
    def get_tools_description(cls) -> str:
        """è·å–æ‰€æœ‰å·¥å…·çš„æè¿°ï¼ˆç”¨äº promptï¼‰"""
        descriptions = []
        for name, tool in cls._tools.items():
            desc = f"- {name}: {tool.definition.description}"
            descriptions.append(desc)
        return "\n".join(descriptions)

# æ³¨å†Œè£…é¥°å™¨
def register_tool():
    """å·¥å…·æ³¨å†Œè£…é¥°å™¨"""
    def decorator(tool_class: Type[BaseTool]):
        instance = tool_class()
        ToolRegistry.register(instance)
        return tool_class
    return decorator
```

---

## 2.3 Windows å‘½ä»¤æ‰§è¡Œè§„åˆ™ï¼ˆåŸºäºå®é™…æµ‹è¯•ï¼‰

> **å‚è€ƒæ–‡æ¡£**: ã€ŠWindowså‘½ä»¤ä½¿ç”¨è§„åˆ™ä¸æµ‹è¯•æŠ¥å‘Š.mdã€‹  
> **æ ¸å¿ƒåŸåˆ™**: ä¸å‡è®¾ç›®æ ‡æœºå™¨æœ‰ Git Bashï¼Œä¼˜å…ˆä½¿ç”¨ Python æ ‡å‡†åº“

**æœ¬ç« ä½ç½®è°ƒæ•´è¯´æ˜**: åŸ 2.5 ç« è°ƒæ•´ä¸º 2.3 ç« ï¼Œä¿æŒç« èŠ‚é¡ºåºè¿ç»­æ€§ï¼ˆv1.2 ä¿®æ­£ï¼‰

### 2.3.1 æ‰§è¡Œç¯å¢ƒå‡è®¾

| ç¯å¢ƒ | å‡è®¾ | è¯´æ˜ |
|------|------|------|
| Git Bash | âŒ ä¸å¯ç”¨ | ç›®æ ‡æœºå™¨å¯èƒ½æœªå®‰è£… Git |
| WSL | âŒ ä¸å¯ç”¨ | ä¸ªäººç‰ˆä¸ä¾èµ– Linux å­ç³»ç»Ÿ |
| PowerShell | âœ… å¯ç”¨ | Windows 7+ é»˜è®¤å®‰è£… |
| CMD | âœ… å¯ç”¨ | æ‰€æœ‰ Windows ç‰ˆæœ¬éƒ½æœ‰ |
| Python | âœ… å¯ç”¨ | ä½œä¸ºåº”ç”¨è¿è¡Œæ—¶ç¯å¢ƒ |

### 2.3.2 å‘½ä»¤é€‰æ‹©ä¼˜å…ˆçº§ï¼ˆç»æµ‹è¯•éªŒè¯ï¼‰

```
1. Python æ ‡å‡†åº“ (é¦–é€‰)  â† è·¨å¹³å°ï¼Œæ— ç¼–ç é—®é¢˜
2. PowerShell (æ¬¡é€‰)    â† Windows åŸç”Ÿï¼ŒåŠŸèƒ½å¼ºå¤§
3. CMD (å¤‡é€‰)          â† å…¼å®¹æ€§æœ€å¥½ï¼Œä½†åŠŸèƒ½æœ‰é™
4. å¤–éƒ¨å·¥å…· (é¿å…)      â† å¢åŠ ä¾èµ–ï¼Œä¸ç¨³å®š
```

### 2.3.3 ç»è¿‡æµ‹è¯•éªŒè¯çš„å‘½ä»¤å¯¹ç…§è¡¨

| åŠŸèƒ½ | Python å®ç° (âœ… æ¨è) | PowerShell å®ç° | CMD å®ç° |
|------|---------------------|----------------|---------|
| **åˆ—å‡ºç›®å½•** | `Path.iterdir()` | `Get-ChildItem` | `dir /b` |
| **è¯»å–æ–‡ä»¶** | `Path.read_text(encoding='utf-8')` | `Get-Content -Encoding UTF8` | `type` |
| **å†™å…¥æ–‡ä»¶** | `Path.write_text(content, encoding='utf-8')` | `Set-Content -Encoding UTF8` | `echo >` |
| **åˆ›å»ºç›®å½•** | `Path.mkdir(parents=True)` | `New-Item -ItemType Directory` | `mkdir` |
| **åˆ é™¤æ–‡ä»¶** | `Path.unlink()` | `Remove-Item` | `del` |
| **ç§»åŠ¨æ–‡ä»¶** | `shutil.move()` | `Move-Item` | `move` |
| **å¤åˆ¶æ–‡ä»¶** | `shutil.copy2()` | `Copy-Item` | `copy` |
| **æ£€æŸ¥å­˜åœ¨** | `Path.exists()` | `Test-Path` | `if exist` |

### 2.3.4 å…³é”®ç¼–ç è§„åˆ™

**å¿…é¡»æ˜¾å¼æŒ‡å®š UTF-8 ç¼–ç **ï¼š
```python
# âœ… æ­£ç¡® - æ˜¾å¼æŒ‡å®š UTF-8ï¼Œæ”¯æŒä¸­æ–‡
content = Path("æ–‡ä»¶.txt").read_text(encoding='utf-8')
Path("è¾“å‡º.txt").write_text("ä¸­æ–‡å†…å®¹", encoding='utf-8')

# PowerShell
Get-Content "æ–‡ä»¶.txt" -Encoding UTF8
Set-Content "è¾“å‡º.txt" -Value "ä¸­æ–‡" -Encoding UTF8
```

**è·¯å¾„ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²**ï¼š
```python
# âœ… æ­£ç¡® - åŸå§‹å­—ç¬¦ä¸²ï¼Œé¿å…è½¬ä¹‰é—®é¢˜
path = r"C:\Users\ç”¨æˆ·å\Documents\file.txt"

# âŒ é”™è¯¯ - éœ€è¦åŒåæ–œæ è½¬ä¹‰
path = "C:\\Users\\ç”¨æˆ·å\\Documents\\file.txt"
```

### 2.3.5 P0 å·¥å…·å®ç°è§„èŒƒï¼ˆåŸºäºæµ‹è¯•ç»“æœï¼‰

**æ‰€æœ‰ P0 å·¥å…·å¿…é¡»ä½¿ç”¨ Python æ ‡å‡†åº“å®ç°**ï¼ŒåŸå› ï¼š
1. âœ… è·¨å¹³å°å…¼å®¹ï¼ˆWindows/Mac/Linuxï¼‰
2. âœ… æ— ç¼–ç é—®é¢˜ï¼ˆPython 3 é»˜è®¤ UTF-8ï¼‰
3. âœ… æ— éœ€å¤–éƒ¨ä¾èµ–
4. âœ… å¼‚å¸¸å¤„ç†æ›´å®Œå–„

**read_file å®ç°ç¤ºä¾‹**ï¼š
```python
from pathlib import Path
from .base import BaseTool, ToolResult

class ReadFileTool(BaseTool):
    """è¯»å–æ–‡ä»¶å·¥å…· - ä½¿ç”¨ç»è¿‡æµ‹è¯•éªŒè¯çš„ Python æ–¹æ³•"""
    
    async def execute(self, path: str, encoding: str = "utf-8") -> ToolResult:
        try:
            file_path = Path(path)
            
            # éªŒè¯è·¯å¾„å­˜åœ¨
            if not file_path.exists():
                return ToolResult(success=False, error=f"æ–‡ä»¶ä¸å­˜åœ¨: {path}")
            
            # è¯»å–å†…å®¹ï¼ˆæµ‹è¯•éªŒè¯çš„æ–¹æ³•ï¼‰
            content = file_path.read_text(encoding=encoding)
            
            return ToolResult(success=True, data={"content": content})
            
        except UnicodeDecodeError:
            return ToolResult(success=False, error="æ–‡ä»¶ç¼–ç é”™è¯¯")
        except PermissionError:
            return ToolResult(success=False, error="æƒé™ä¸è¶³")
        except Exception as e:
            return ToolResult(success=False, error=str(e))
```

---

## 2.4 æ—¥å¿—ä¸å¯è§‚æµ‹æ€§è®¾è®¡ï¼ˆéµå¾ª v2.1 è§„èŒƒï¼‰

**æœ¬ç« ä½ç½®è°ƒæ•´è¯´æ˜**: åŸ 2.6 ç« è°ƒæ•´ä¸º 2.4 ç« ï¼Œä¿æŒç« èŠ‚é¡ºåºè¿ç»­æ€§ï¼ˆv1.2 ä¿®æ­£ï¼‰

> **å‚è€ƒè§„èŒƒ**: ã€Šå¼€å‘ç­–ç•¥è§„èŒƒ-v2.1.mdã€‹ç¬¬ 3.5 ç« 

### 2.4.1 ReAct æ‰§è¡Œå™¨æ—¥å¿—éœ€æ±‚

æ ¹æ® v2.1 æ—¥å¿—è®¾è®¡è§„èŒƒï¼ŒReAct æ‰§è¡Œå™¨å¿…é¡»è®°å½•ï¼š

| æ—¥å¿—ç±»å‹ | è®°å½•å†…å®¹ | çº§åˆ« | ç”¨é€” |
|---------|---------|------|------|
| **æ‰§è¡Œå¼€å§‹** | ç”¨æˆ·è¾“å…¥ã€åˆå§‹ä¸Šä¸‹æ–‡ | INFO | è¿½è¸ªæ‰§è¡Œæµç¨‹ |
| **æ€è€ƒè¿‡ç¨‹** | AI æ€è€ƒå†…å®¹ã€å†³ç­–ä¾æ® | DEBUG | è°ƒè¯•å†³ç­–é€»è¾‘ |
| **å·¥å…·è°ƒç”¨** | å·¥å…·åç§°ã€å‚æ•°ã€æ‰§è¡Œè€—æ—¶ | INFO | ç›‘æ§å·¥å…·ä½¿ç”¨ |
| **å·¥å…·ç»“æœ** | æˆåŠŸ/å¤±è´¥ã€è¿”å›å€¼ã€é”™è¯¯ | INFO/WARNING | è¿½è¸ªæ‰§è¡Œç»“æœ |
| **é‡è¯•è®°å½•** | é‡è¯•æ¬¡æ•°ã€å¤±è´¥åŸå›  | WARNING | ç›‘æ§ç¨³å®šæ€§ |
| **æ‰§è¡Œå®Œæˆ** | æ€»è€—æ—¶ã€æœ€ç»ˆç­”æ¡ˆ | INFO | ç»Ÿè®¡æ‰§è¡Œæ•ˆç‡ |
| **å¼‚å¸¸é”™è¯¯** | å¼‚å¸¸ç±»å‹ã€å †æ ˆ | ERROR | é—®é¢˜æ’æŸ¥ |

### 2.4.2 æ—¥å¿—é›†æˆè®¾è®¡

```python
# app/core/react_executor.py - æ—¥å¿—é›†æˆ
from app.utils.logger import api_logger
import time

class ReActExecutor:
    """ReAct æ‰§è¡Œå™¨ï¼ˆå«æ—¥å¿—è®°å½•ï¼‰"""
    
    async def execute(self, user_input: str, history: List[Dict] = None) -> Dict:
        # ç”Ÿæˆè¯·æ±‚ ID ç”¨äºå…¨é“¾è·¯è¿½è¸ª
        request_id = api_logger.log_request_start(
            provider="react_executor",
            model="react_loop",
            message_len=len(user_input),
            history_count=len(history) if history else 0
        )
        
        start_time = time.time()
        iterations = 0
        
        try:
            while iterations < self.max_iterations:
                iterations += 1
                
                # è®°å½•æ€è€ƒè¿‡ç¨‹
                self.logger.debug(f"[{request_id}] ç¬¬{iterations}è½®æ€è€ƒå¼€å§‹")
                thought = await self._think(context, history)
                self.logger.debug(f"[{request_id}] æ€è€ƒ: {thought.get('thought', '')[:100]}...")
                
                # æ£€æŸ¥æ˜¯å¦ç»“æŸ
                if thought.get("should_stop", False):
                    self.logger.info(f"[{request_id}] ä»»åŠ¡å®Œæˆï¼Œå…±{iterations}è½®")
                    break
                
                # è®°å½•å·¥å…·è°ƒç”¨
                action = thought.get("action")
                if action:
                    tool_name = action.get("tool")
                    self.logger.info(f"[{request_id}] è°ƒç”¨å·¥å…·: {tool_name}")
                    
                    # æ‰§è¡Œå·¥å…·
                    tool_start = time.time()
                    observation = await self._act(action)
                    tool_elapsed = time.time() - tool_start
                    
                    # è®°å½•å·¥å…·ç»“æœ
                    if observation.get("success"):
                        self.logger.info(
                            f"[{request_id}] å·¥å…·æ‰§è¡ŒæˆåŠŸ: {tool_name}, "
                            f"è€—æ—¶: {tool_elapsed:.2f}s"
                        )
                    else:
                        self.logger.warning(
                            f"[{request_id}] å·¥å…·æ‰§è¡Œå¤±è´¥: {tool_name}, "
                            f"é”™è¯¯: {observation.get('error', 'Unknown')}"
                        )
                        
                        # è®°å½•é‡è¯•
                        for attempt in range(self.retry_attempts):
                            self.logger.info(f"[{request_id}] ç¬¬{attempt+1}æ¬¡é‡è¯•...")
                            # ... é‡è¯•é€»è¾‘
            
            # è®°å½•æ‰§è¡Œå®Œæˆ
            total_elapsed = time.time() - start_time
            api_logger.log_response_with_time(
                request_id=request_id,
                provider="react_executor",
                status_code=200 if context.get("success") else 500,
                content_len=len(context.get("final_answer", "")),
                error=None if context.get("success") else context.get("error")
            )
            
            self.logger.info(
                f"[{request_id}] ReActæ‰§è¡Œå®Œæˆ, "
                f"æ€»è€—æ—¶: {total_elapsed:.2f}s, "
                f"è¿­ä»£æ¬¡æ•°: {iterations}"
            )
            
        except Exception as e:
            self.logger.exception(f"[{request_id}] ReActæ‰§è¡Œå¼‚å¸¸")
            api_logger.log_error("react_executor", str(e))
            raise
```

### 2.4.3 å·¥å…·æ‰§è¡Œæ—¥å¿—

**æ¯ä¸ªå·¥å…·å¿…é¡»è®°å½•**ï¼š
```python
# app/tools/file_tools.py - å·¥å…·æ—¥å¿—ç¤ºä¾‹
from app.utils.logger import api_logger

class ReadFileTool(BaseTool):
    async def execute(self, path: str, **kwargs) -> ToolResult:
        request_id = api_logger.log_request_start(
            provider="tool",
            model=self.definition.name,  # "read_file"
            message_len=len(path)
        )
        
        start_time = time.time()
        
        try:
            # ... æ‰§è¡Œé€»è¾‘
            result = ToolResult(success=True, data={...})
            
            api_logger.log_response_with_time(
                request_id=request_id,
                provider="tool",
                status_code=200,
                content_len=len(result.data.get("content", "")),
                error=None
            )
            
            return result
            
        except Exception as e:
            api_logger.log_response_with_time(
                request_id=request_id,
                provider="tool",
                status_code=500,
                error=str(e)
            )
            return ToolResult(success=False, error=str(e))
```

### 2.4.4 æ—¥å¿—æ–‡ä»¶ç»“æ„

æ‰§è¡Œåæ—¥å¿—ç¤ºä¾‹ï¼š
```log
2026-02-16 09:14:01,234 - INFO - [react_executor] è¯·æ±‚å¼€å§‹ | ID: a1b2c3d4 | æ¶ˆæ¯é•¿åº¦: 50 | å†å²æ¶ˆæ¯æ•°: 0
2026-02-16 09:14:01,567 - DEBUG - [a1b2c3d4] ç¬¬1è½®æ€è€ƒå¼€å§‹
2026-02-16 09:14:03,890 - DEBUG - [a1b2c3d4] æ€è€ƒ: ç”¨æˆ·è¦æ±‚è¯»å–æ–‡ä»¶ï¼Œæˆ‘éœ€è¦ä½¿ç”¨read_fileå·¥å…·...
2026-02-16 09:14:03,891 - INFO - [a1b2c3d4] è°ƒç”¨å·¥å…·: read_file
2026-02-16 09:14:03,892 - INFO - [tool] è¯·æ±‚å¼€å§‹ | ID: e5f6g7h8 | æ¨¡å‹: read_file | æ¶ˆæ¯é•¿åº¦: 20
2026-02-16 09:14:03,895 - INFO - [tool] å“åº”æˆåŠŸ | ID: e5f6g7h8 | çŠ¶æ€ç : 200 | å†…å®¹é•¿åº¦: 1024 | è€—æ—¶: 0.01s
2026-02-16 09:14:03,896 - INFO - [a1b2c3d4] å·¥å…·æ‰§è¡ŒæˆåŠŸ: read_file, è€—æ—¶: 0.01s
2026-02-16 09:14:04,123 - INFO - [react_executor] å“åº”æˆåŠŸ | ID: a1b2c3d4 | çŠ¶æ€ç : 200 | å†…å®¹é•¿åº¦: 150 | è€—æ—¶: 2.89s
```

---

## 3. æ•°æ®ç»“æ„è®¾è®¡

### 3.1 æ¶ˆæ¯å†å²

```python
# app/models/message.py
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

class Message(BaseModel):
    """æ¶ˆæ¯æ¨¡å‹"""
    role: str  # "user", "assistant", "system", "tool"
    content: str
    tool_calls: Optional[List[Dict]] = None
    tool_results: Optional[List[Dict]] = None
    timestamp: datetime = datetime.now()
```

### 3.2 æ‰§è¡Œä¸Šä¸‹æ–‡

```python
# app/models/execution.py
from pydantic import BaseModel
from typing import List, Dict, Any, Optional

class ExecutionContext(BaseModel):
    """æ‰§è¡Œä¸Šä¸‹æ–‡"""
    user_input: str
    thoughts: List[Dict] = []
    actions: List[Dict] = []
    observations: List[Dict] = []
    final_answer: Optional[str] = None
    success: bool = False
    error: Optional[str] = None
```

---

## 4. éªŒæ”¶æ ‡å‡†

### 4.1 åŠŸèƒ½éªŒæ”¶

| éªŒæ”¶é¡¹ | éªŒæ”¶æ ‡å‡† | éªŒè¯æ–¹æ³• |
|--------|---------|---------|
| **å·¥å…·æ³¨å†Œ** | 4ä¸ª P0 å·¥å…·éƒ½èƒ½æ­£ç¡®æ³¨å†Œ | è°ƒç”¨ `ToolRegistry.list_tools()` éªŒè¯ |
| **read_file** | èƒ½è¯»å–æ–‡æœ¬æ–‡ä»¶å¹¶è¿”å›å†…å®¹ | å•å…ƒæµ‹è¯•ï¼šè¯»å–æµ‹è¯•æ–‡ä»¶ |
| **write_file** | èƒ½åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥å†…å®¹ | å•å…ƒæµ‹è¯•ï¼šå†™å…¥åè¯»å–éªŒè¯ |
| **list_directory** | èƒ½åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶ | å•å…ƒæµ‹è¯•ï¼šå¯¹æ¯” os.listdir |
| **move_file** | èƒ½ç§»åŠ¨/é‡å‘½åæ–‡ä»¶ | å•å…ƒæµ‹è¯•ï¼šç§»åŠ¨åéªŒè¯ |
| **ReActå¾ªç¯** | èƒ½å®Œæˆè‡³å°‘3è½®æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿ | é›†æˆæµ‹è¯•ï¼šæ¨¡æ‹Ÿå¤æ‚ä»»åŠ¡ |
| **é”™è¯¯é‡è¯•** | å¤±è´¥3æ¬¡åæ‰æŠ¥é”™ | å•å…ƒæµ‹è¯•ï¼šæ¨¡æ‹Ÿå¤±è´¥åœºæ™¯ |
| **æ—¥å¿—è®°å½•** | æ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½æœ‰æ—¥å¿—ï¼ŒåŒ…å«è€—æ—¶ | æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å†…å®¹ |
| **Windows å…¼å®¹** | åœ¨ Windows 11 + PS 5.1 ä¸‹æµ‹è¯•é€šè¿‡ | å®é™…è¿è¡Œæµ‹è¯• |
| **ä¸­æ–‡è·¯å¾„** | èƒ½è¯»å–/å†™å…¥ä¸­æ–‡è·¯å¾„æ–‡ä»¶ | å•å…ƒæµ‹è¯•ï¼šä½¿ç”¨ä¸­æ–‡è·¯å¾„æµ‹è¯• |

**éªŒæ”¶æ ‡å‡†è¡¥å……è¯´æ˜**ï¼ˆv1.2 æ–°å¢ï¼‰ï¼š
- æ—¥å¿—éªŒæ”¶éœ€éªŒè¯ï¼šè¯·æ±‚IDã€å·¥å…·åç§°ã€æ‰§è¡Œè€—æ—¶ã€æˆåŠŸ/å¤±è´¥çŠ¶æ€
- Windows å…¼å®¹éœ€éªŒè¯ï¼šPowerShell 5.1 ç¯å¢ƒä¸‹æ‰€æœ‰å·¥å…·æ­£å¸¸æ‰§è¡Œ
- ä¸­æ–‡è·¯å¾„éœ€éªŒè¯ï¼šåŒ…å«ä¸­æ–‡çš„æ–‡ä»¶åå’Œç›®å½•åéƒ½èƒ½æ­£ç¡®å¤„ç†

### 4.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | è¦æ±‚ | æµ‹è¯•æ–¹æ³• |
|------|------|---------|
| å·¥å…·æ‰§è¡Œæ—¶é—´ | < 100ms | å•å…ƒæµ‹è¯•è®¡æ—¶ |
| ReActå•æ¬¡è¿­ä»£ | < 5s (å«AIè°ƒç”¨) | é›†æˆæµ‹è¯•è®¡æ—¶ |
| å†…å­˜å ç”¨ | < 50MB | è¿è¡Œæ—¶ç›‘æ§ |

### 4.3 è´¨é‡éªŒæ”¶

- [ ] **æµ‹è¯•è¦†ç›–ç‡**: â‰¥ 80%
- [ ] **ä»£ç å®¡æŸ¥**: æ— ä¸¥é‡é—®é¢˜
- [ ] **æ–‡æ¡£å®Œæ•´æ€§**: æ‰€æœ‰å·¥å…·éƒ½æœ‰ä½¿ç”¨è¯´æ˜
- [ ] **é”™è¯¯å¤„ç†**: æ‰€æœ‰å¼‚å¸¸éƒ½æœ‰åˆé€‚çš„é”™è¯¯æç¤º

---

## 5. é£é™©é¢„ä¼°

### 5.1 æŠ€æœ¯é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æªæ–½ |
|------|--------|------|---------|
| AI ä¸è¾“å‡ºæ ‡å‡†æ ¼å¼ | ä¸­ | é«˜ | æ·»åŠ æ ¼å¼æ ¡éªŒå’Œé‡è¯•æœºåˆ¶ |
| å·¥å…·æ‰§è¡Œæƒé™ä¸è¶³ | ä¸­ | é«˜ | æ·»åŠ æƒé™æ£€æŸ¥å’Œå‹å¥½æç¤º |
| æ–‡ä»¶æ“ä½œå¼‚å¸¸ï¼ˆå ç”¨ç­‰ï¼‰ | ä¸­ | ä¸­ | æ·»åŠ å¼‚å¸¸å¤„ç†å’Œé‡è¯• |
| æ­»å¾ªç¯é£é™© | ä½ | é«˜ | è®¾ç½® max_iterations é™åˆ¶ |
| AI å“åº”æ ¼å¼ä¸ç¨³å®š | é«˜ | ä¸­ | æ·»åŠ  JSON Schema æ ¡éªŒå’Œå®¹é”™è§£æ |
| æ—¥å¿—ç³»ç»Ÿæ•…éšœ | ä½ | ä¸­ | ç¡®ä¿æ—¥å¿—ç³»ç»Ÿç¨³å®šï¼ˆPhase 1.2 å·²ä¿®å¤ï¼‰ |

**é£é™©è¡¥å……è¯´æ˜**ï¼ˆv1.2 æ–°å¢ï¼‰ï¼š
- **AI å“åº”æ ¼å¼ä¸ç¨³å®š**ï¼šReAct ä¾èµ– AI è¾“å‡ºæ ‡å‡† JSONï¼Œå¯èƒ½è§£æå¤±è´¥ï¼Œéœ€æ·»åŠ  try-except å’Œé‡è¯•
- **æ—¥å¿—ç³»ç»Ÿæ•…éšœ**ï¼šå¦‚æœ Phase 1.2 çš„æ—¥å¿—ç³»ç»Ÿæœ‰é—®é¢˜ï¼Œä¼šå½±å“ ReAct è°ƒè¯•ï¼Œéœ€ç¡®ä¿ api_logger åˆå§‹åŒ–æ­£ç¡®

### 5.2 ä¾èµ–é£é™©

| ä¾èµ– | é£é™©æè¿° | åº”å¯¹æªæ–½ |
|------|---------|---------|
| Phase 1.2 | AI æœåŠ¡ä¸ç¨³å®š | ä½¿ç”¨ OpenCode ä½œä¸ºå¤‡é€‰ |
| æ–‡ä»¶ç³»ç»Ÿ | Windows è·¯å¾„é—®é¢˜ | ä½¿ç”¨ pathlib å¤„ç†è·¨å¹³å° |

---

## 6. å®æ–½è®¡åˆ’

### 6.1 å¼€å‘é¡ºåº

```
Day 1-2: å·¥å…·æ¡†æ¶
  â”œâ”€ å·¥å…·åŸºç±» (BaseTool)
  â”œâ”€ å·¥å…·æ³¨å†Œè¡¨ (ToolRegistry)
  â””â”€ å·¥å…·å®šä¹‰ Schema

Day 3-4: P0 å·¥å…·å®ç°
  â”œâ”€ read_file
  â”œâ”€ write_file
  â”œâ”€ list_directory
  â””â”€ move_file

Day 5: ReAct æ¡†æ¶å’Œ Think é˜¶æ®µ
  â”œâ”€ ReActExecutor ç±»æ¡†æ¶æ­å»º
  â”œâ”€ execute() ä¸»å¾ªç¯å®ç°ï¼ˆå« max_iterations é™åˆ¶ï¼‰
  â”œâ”€ _think() æ–¹æ³•å®ç°
  â”‚   â”œâ”€ Prompt æ¨¡æ¿æ„å»ºï¼ˆå«å·¥å…·æè¿°ã€å†å²ä¸Šä¸‹æ–‡ï¼‰
  â”‚   â”œâ”€ è°ƒç”¨ AI æœåŠ¡è·å–å“åº”
  â”‚   â””â”€ è§£æ AI å“åº”ä¸ºç»“æ„åŒ–æ•°æ®
  â””â”€ _parse_thought_response() æ–¹æ³•å®ç°

Day 6: Actã€Observation å’Œæ—¥å¿—é›†æˆ
  â”œâ”€ _act() æ–¹æ³•å®ç°ï¼ˆå·¥å…·è°ƒç”¨æ‰§è¡Œï¼‰
  â”œâ”€ _retry_action() é‡è¯•é€»è¾‘å®ç°
  â”‚   â”œâ”€ æŒ‡æ•°é€€é¿ç­–ç•¥
  â”‚   â””â”€ æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ï¼ˆ3æ¬¡ï¼‰
  â”œâ”€ æ—¥å¿—ç³»ç»Ÿé›†æˆï¼ˆä¸ Phase 1.2 æ—¥å¿—ç³»ç»Ÿå¯¹æ¥ï¼‰
  â”‚   â”œâ”€ ReActExecutor æ—¥å¿—è®°å½•
  â”‚   â”œâ”€ å·¥å…·è°ƒç”¨æ—¥å¿—è®°å½•
  â”‚   â””â”€ æ‰§è¡Œè€—æ—¶ç»Ÿè®¡
  â””â”€ é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µæµ‹è¯•

Day 7: æµ‹è¯•å’Œæ–‡æ¡£
  â”œâ”€ å•å…ƒæµ‹è¯• (è¦†ç›–ç‡â‰¥80%)
  â”œâ”€ é›†æˆæµ‹è¯•
  â”œâ”€ å·¥å…·ä½¿ç”¨æ–‡æ¡£
  â””â”€ é˜¶æ®µæ€»ç»“
```

### 6.2 æ–‡ä»¶æ¸…å•

**æ–°å¢æ–‡ä»¶**:
- `app/tools/base.py` - å·¥å…·åŸºç±»å’Œå®šä¹‰
- `app/tools/registry.py` - å·¥å…·æ³¨å†Œè¡¨
- `app/tools/file_tools.py` - æ–‡ä»¶æ“ä½œå·¥å…·
- `app/core/react_executor.py` - ReAct æ‰§è¡Œå™¨
- `app/models/message.py` - æ¶ˆæ¯æ¨¡å‹
- `app/models/execution.py` - æ‰§è¡Œä¸Šä¸‹æ–‡æ¨¡å‹
- `tests/test_tools.py` - å·¥å…·å•å…ƒæµ‹è¯•
- `tests/test_react.py` - ReAct é›†æˆæµ‹è¯•

**ä¿®æ”¹æ–‡ä»¶**:
- `app/main.py` - æ³¨å†Œå·¥å…·å’Œ ReAct æ‰§è¡Œå™¨
- `app/api/v1/chat.py` - é›†æˆ ReAct åˆ°å¯¹è¯æ¥å£

### 6.3 API é›†æˆæ–¹æ¡ˆï¼ˆv1.2 æ–°å¢ï¼‰

#### 6.3.1 æ–°ç«¯ç‚¹è®¾è®¡

**ç«¯ç‚¹ 1: ReAct å¯¹è¯ç«¯ç‚¹**
```
POST /api/v1/chat/react
```

**è¯·æ±‚ä½“**:
```json
{
  "message": "ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯",
  "history": [
    {"role": "user", "content": "å†å²æ¶ˆæ¯1"},
    {"role": "assistant", "content": "å†å²å›å¤1"}
  ],
  "max_iterations": 10
}
```

**å“åº”ä½“**:
```json
{
  "success": true,
  "answer": "ReAct æ‰§è¡Œåçš„æœ€ç»ˆç­”æ¡ˆ",
  "execution_log": [
    {
      "iteration": 1,
      "thought": "æ€è€ƒå†…å®¹...",
      "action": {"tool": "read_file", "params": {"path": "file.txt"}},
      "observation": {"success": true, "data": {...}}
    }
  ],
  "total_iterations": 3,
  "total_time": 5.23
}
```

#### 6.3.2 ç°æœ‰ç«¯ç‚¹ä¿®æ”¹

**ç«¯ç‚¹ 2: æ ‡å‡†å¯¹è¯ç«¯ç‚¹ï¼ˆå¢å¼ºï¼‰**
```
POST /api/v1/chat
```

**æ–°å¢å‚æ•°**:
```json
{
  "message": "ç”¨æˆ·è¾“å…¥",
  "use_react": true,  // æ–°å¢å‚æ•°ï¼šæ˜¯å¦ä½¿ç”¨ ReAct æ¨¡å¼
  "history": []
}
```

**è¡Œä¸º**:
- `use_react: false`ï¼ˆé»˜è®¤ï¼‰ï¼šç›´æ¥è°ƒç”¨ AI æœåŠ¡ï¼Œç®€å•å¯¹è¯
- `use_react: true`ï¼šä½¿ç”¨ ReAct æ‰§è¡Œå™¨ï¼Œæ”¯æŒå·¥å…·è°ƒç”¨

#### 6.3.3 API å®ç°ä»£ç ç¤ºä¾‹

```python
# app/api/v1/chat.py
from app.core.react_executor import ReActExecutor
from app.tools.registry import ToolRegistry

@router.post("/chat/react")
async def chat_with_react(
    request: ChatRequest,
    background_tasks: BackgroundTasks
) -> ChatResponse:
    """ä½¿ç”¨ ReAct æ‰§è¡Œå¯¹è¯"""
    # è·å– AI æœåŠ¡
    ai_service = AIServiceFactory.get_service()
    
    # è·å–å·¥å…·æ³¨å†Œè¡¨
    tool_registry = ToolRegistry()
    
    # åˆ›å»º ReAct æ‰§è¡Œå™¨
    executor = ReActExecutor(ai_service, tool_registry)
    
    # æ‰§è¡Œ ReAct å¾ªç¯
    result = await executor.execute(
        user_input=request.message,
        history=request.history
    )
    
    return ChatResponse(
        success=result["success"],
        answer=result.get("answer", ""),
        execution_log=result.get("context", {}),
        total_iterations=len(result.get("context", {}).get("actions", [])),
        total_time=result.get("total_time", 0)
    )
```

---

## 7. å‚è€ƒèµ„æ–™

### 7.1 è®¾è®¡å‚è€ƒ
- ReAct è®ºæ–‡: *ReAct: Synergizing Reasoning and Acting in Language Models*
- åŸç‰ˆ `AI_OSShell_v2.py` ä¸­çš„å·¥å…·è°ƒç”¨é€»è¾‘
- ã€Šå¼€å‘ç­–ç•¥è§„èŒƒ v2.1ã€‹ç¬¬ 12.3 èŠ‚ ReAct Executor å®ç°è§„èŒƒ

### 7.2 æŠ€æœ¯å‚è€ƒ
- Pydantic æ–‡æ¡£: https://docs.pydantic.dev/
- Python `pathlib` æ¨¡å—æ–‡æ¡£

---

## 8. è®¾è®¡è¯„å®¡

### 8.1 è‡ªæ£€æ¸…å•

- [x] å·¥å…· Schema è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ
- [x] ReAct å¾ªç¯æ˜¯å¦èƒ½é˜²æ­¢æ­»å¾ªç¯ï¼Ÿ
- [x] é”™è¯¯å¤„ç†æœºåˆ¶æ˜¯å¦å®Œå–„ï¼Ÿ
- [x] æ˜¯å¦è€ƒè™‘äº†æƒé™å’Œå®‰å…¨é—®é¢˜ï¼Ÿ
- [x] æµ‹è¯•è®¡åˆ’æ˜¯å¦å®Œæ•´ï¼Ÿ

### 8.2 å¾…ç¡®è®¤é—®é¢˜ï¼ˆv1.2 å·²ç­”å¤ï¼‰

1. **å·¥å…·å‚æ•°éªŒè¯**: æ˜¯å¦éœ€è¦æ›´ä¸¥æ ¼çš„å‚æ•°æ ¡éªŒï¼ˆå¦‚è·¯å¾„åˆæ³•æ€§æ£€æŸ¥ï¼‰ï¼Ÿ
   - **ç­”å¤**: âœ… **æ˜¯ï¼Œéœ€è¦**
   - **å®æ–½æ–¹æ¡ˆ**: 
     - ä½¿ç”¨ `Path.exists()` æ£€æŸ¥è·¯å¾„å­˜åœ¨æ€§
     - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥è·¯å¾„æ ¼å¼ï¼ˆé˜²æ­¢è·¯å¾„éå†æ”»å‡»ï¼‰
     - å¯¹ `write_file` ç­‰å±é™©æ“ä½œï¼Œæ£€æŸ¥æ–‡ä»¶æ‰©å±•åç™½åå•

2. **AI Prompt**: ReAct çš„ prompt æ¨¡æ¿æ˜¯å¦éœ€è¦ç”¨æˆ·å¯é…ç½®ï¼Ÿ
   - **ç­”å¤**: âŒ **å¦ï¼Œå…ˆå†…ç½®**
   - **ç†ç”±**: 
     - MVP é˜¶æ®µä¿æŒç®€å•
     - å†…ç½® prompt ç»è¿‡æµ‹è¯•ï¼Œç¨³å®šæ€§æ›´å¥½
     - åç»­ç‰ˆæœ¬ï¼ˆPhase 2.xï¼‰å†è€ƒè™‘å¼€æ”¾é…ç½®

3. **æ‰§è¡Œè¶…æ—¶**: æ•´ä¸ª ReAct å¾ªç¯æ˜¯å¦éœ€è¦æ€»è¶…æ—¶é™åˆ¶ï¼Ÿ
   - **ç­”å¤**: âœ… **æ˜¯ï¼Œéœ€è¦**
   - **å®æ–½æ–¹æ¡ˆ**: 
     - è®¾ç½® **30 ç§’** æ€»è¶…æ—¶
     - æ¯æ¬¡ AI è°ƒç”¨è®¾ç½® **10 ç§’** è¶…æ—¶
     - è¶…æ—¶æ—¶è¿”å›éƒ¨åˆ†ç»“æœå’Œè¶…æ—¶åŸå› 
     - å‰ç«¯æ˜¾ç¤ºè¿›åº¦å’Œè¶…æ—¶æç¤º

---

## 9. ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢äºº | ä¿®è®¢å†…å®¹ |
|------|------|--------|---------|
| v1.0 | 2026-02-16 09:17:14 | AIåŠ©æ‰‹å°æ¬§ | åˆå§‹ç‰ˆæœ¬ï¼ŒPhase 1.3 è®¾è®¡æ–‡æ¡£ |
| v1.1 | 2026-02-16 09:17:14 | AIåŠ©æ‰‹å°æ¬§ | æ–°å¢ç¬¬2.5ç«  Windowså‘½ä»¤æ‰§è¡Œè§„åˆ™ï¼Œæ–°å¢ç¬¬2.6ç« æ—¥å¿—ä¸å¯è§‚æµ‹æ€§è®¾è®¡ï¼ŒåŸºäºå®é™…æµ‹è¯•éªŒè¯çš„å‘½ä»¤ä½¿ç”¨æ–¹æ¡ˆ |
| v1.2 | 2026-02-16 09:35:45 | AIåŠ©æ‰‹å°æ¬§ | ä¿®æ­£ç« èŠ‚ç¼–å·ï¼ˆ2.5â†’2.3, 2.6â†’2.4ï¼‰ï¼Œè¡¥å……éªŒæ”¶æ ‡å‡†ï¼ˆæ—¥å¿—ã€Winå…¼å®¹ã€ä¸­æ–‡ï¼‰ï¼Œè¡¥å……é£é™©é¡¹ï¼ˆAIæ ¼å¼ã€æ—¥å¿—æ•…éšœï¼‰ï¼Œç»†åŒ–Day 5-6ä»»åŠ¡ï¼Œæ·»åŠ APIé›†æˆæ–¹æ¡ˆï¼Œç­”å¤å¾…ç¡®è®¤é—®é¢˜ |

---

**æ–‡æ¡£ç»“æŸ**

**ç”¨æˆ·ç¡®è®¤**:
- [ ] å·²é˜…è¯»å…¨æ–‡
- [ ] ç†è§£æŠ€æœ¯æ–¹æ¡ˆ
- [ ] è®¤å¯éªŒæ”¶æ ‡å‡†
- [ ] æ‰¹å‡†è¿›å…¥å¼€å‘é˜¶æ®µ

**ç¡®è®¤äºº**: _______________  
**ç¡®è®¤æ—¥æœŸ**: YYYY-MM-DD
