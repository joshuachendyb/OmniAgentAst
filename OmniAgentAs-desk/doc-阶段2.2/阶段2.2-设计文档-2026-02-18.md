# 阶段2.2：工具集扩展+历史管理 - 设计文档

**文档编号**: OMA-DESIGN-2.2  
**版本**: v1.0  
**创建时间**: 2026-02-18 17:46:08  
**更新**: 2026-02-18 18:00:00  
**阶段状态**: ⏸️待启动  
**前置依赖**: 阶段2.1 Web对话界面+配置+安全（已完成）

---

> **v1.0 修正说明 (2026-02-18 18:00:00)**：
> - 修正P1级工具列表，严格按开发优先级计划第2.2.1节（6个工具）
> - 移除不在计划中的工具（进程管理等），移至"可选扩展"
> - 修正文件操作工具说明（create_directory/delete_file已在阶段1.3实现）
> - 统一截图工具设计（单工具多模式，符合计划要求）

---

> **设计说明**：
> 本阶段在阶段2.1的基础上，扩展工具集能力（P1/P2级工具）和实现对话历史管理。
> 设计严格遵循[开发优先级计划v1.1](../doc/桌面omni开发优先级计划.md)和阶段2.1确立的技术栈。
> 
> **设计约束**：
> - P1级工具严格按计划定义，不随意扩展范围
> - P2级工具按计划定义，可适度细化实现方案
> - 历史管理为阶段2.2新增核心功能

---

## 1. 设计目标

### 1.1 核心目标
在阶段2.1基础上，扩展AI助手的工具能力和历史管理功能：

1. **工具集扩展**：实现P1级系统工具（窗口管理、截图、shell执行）和P2级辅助工具（剪贴板、系统信息）
2. **历史管理**：实现对话历史的持久化存储、查询和恢复
3. **用户体验**：支持多会话管理，提升长期使用价值

### 1.2 设计原则

- **能力增强**：在现有文件操作基础上，增加系统级操作能力
- **安全第一**：所有系统工具必须经过严格的安全校验
- **数据持久**：对话历史和系统配置持久化到SQLite数据库
- **向后兼容**：新功能不影响阶段2.1已实现的对话功能

---

## 2. 功能需求

### 2.1 P1级工具集（高优先级）

> **重要说明**：P1级工具严格遵循[开发优先级计划v1.1](../doc/桌面omni开发优先级计划.md)第2.2.1节定义的工具列表，共6个工具。

#### 2.1.1 窗口管理工具

**功能说明**：管理系统窗口，支持窗口切换和信息获取

**工具列表**（严格按开发优先级计划）：

| 工具名 | 功能 | 参数 | 返回值 | 安全级别 |
|--------|------|------|--------|----------|
| `list_windows` | 列出所有窗口 | - | 窗口列表（标题、PID） | 低 |
| `switch_window` | 切换到指定窗口 | window_id | 成功/失败 | 中 |

**实现限制**：
- Windows平台使用Win32 API（pywin32）
- macOS平台使用AppleScript/AppKit
- Linux平台使用xdotool
- Web版仅提供信息展示，实际操作用桌面版

**安全机制**：
- 禁止操作系统关键窗口（任务管理器、桌面等）

#### 2.1.2 截图工具

**功能说明**：屏幕截图功能，支持全屏、窗口截图

**工具列表**（严格按开发优先级计划）：

| 工具名 | 功能 | 参数 | 返回值 | 格式 |
|--------|------|------|--------|------|
| `screenshot` | 截图 | target: "full" \| "window", window_id?: string | 图片路径 | PNG |

**实现方案**：
- 使用Pillow/PIL库实现截图
- 图片保存到临时目录，返回路径
- target参数指定截图目标："full"全屏、"window"指定窗口
- Web版通过前端实现（html2canvas），仅支持全屏截图

#### 2.1.3 Shell命令执行（受限）

**功能说明**：执行安全的shell命令，支持文件和系统查询

**工具名**：`run_shell`

**参数**：
```typescript
{
  command: string;    // 命令字符串
  timeout?: number;   // 超时时间（秒），默认30s
  cwd?: string;       // 工作目录
}
```

**返回值**：
```typescript
{
  success: boolean;
  stdout: string;
  stderr: string;
  exit_code: number;
  execution_time: number;
}
```

**安全限制（已在阶段2.1实现基础上扩展）**：
- ✅ 黑名单机制（rm -rf、format、mkfs等）
- ✅ 白名单机制（可配置允许执行的命令）
- ✅ 危险操作确认（删除、修改系统文件）
- ✅ 超时控制（防止长时间阻塞）
- ✅ 输出长度限制（防止返回过多数据）

**允许命令示例**：
```bash
# 文件查询
ls -la
dir
find . -name "*.py"

# 系统查询
pwd
whoami
date
env | grep PATH

# 网络查询
ping -c 4 google.com
curl -I https://api.example.com

# Git操作（只读）
git status
git log --oneline -10
git diff --stat
```

#### 2.1.4 文件操作增强

**说明**：`create_directory`和`delete_file`已在阶段1.3/2.1实现基础版本，阶段2.2进行功能增强。

**增强内容**：

| 工具名 | 当前状态 | 阶段2.2增强 | 说明 |
|--------|----------|-------------|------|
| `create_directory` | ✅ 已实现（P0） | 支持多级目录创建 | 扩展mkdir -p功能 |
| `delete_file` | ✅ 已实现（P0） | 危险操作确认弹窗 | 与阶段2.1安全框架集成 |

**注意**：`delete_file`已在阶段1.3实现，阶段2.2主要工作是集成阶段2.1的安全确认弹窗机制。

### 2.2 P2级工具集（可选/增强）

#### 2.2.1 剪贴板工具

**工具列表**：

| 工具名 | 功能 | 说明 |
|--------|------|------|
| `clipboard_read` | 读取剪贴板 | 文本内容 |
| `clipboard_write` | 写入剪贴板 | 文本内容 |
| `clipboard_clear` | 清空剪贴板 | - |

**限制**：
- Web版不支持（浏览器安全限制）
- 桌面版使用pyperclip库

#### 2.2.2 系统信息工具

**工具列表**（严格按开发优先级计划）：

| 工具名 | 功能 | 返回值 |
|--------|------|--------|
| `get_system_info` | 系统基本信息 | OS、版本、架构、CPU、内存、磁盘概要 |

**实现**：使用psutil库

**返回数据示例**：
```json
{
  "os": "Windows 10",
  "version": "10.0.19045",
  "architecture": "x64",
  "cpu": {
    "cores": 8,
    "usage_percent": 15.2
  },
  "memory": {
    "total_gb": 16,
    "available_gb": 8.5,
    "usage_percent": 46.8
  },
  "disk": {
    "total_gb": 512,
    "free_gb": 128,
    "usage_percent": 75.0
  }
}
```

#### 2.2.3 可选扩展工具（未来阶段）

**说明**：以下工具不在阶段2.2开发计划中，作为未来扩展预留。

| 工具名 | 功能 | 安全级别 | 计划阶段 |
|--------|------|----------|---------|
| `list_processes` | 列出进程 | 低 | 3.2 |
| `get_process_info` | 获取进程详情 | 低 | 3.2 |
| `kill_process` | 结束进程 | **高** | 3.2 |
| `get_cpu_info` | CPU详细信息 | 低 | P2扩展 |
| `get_memory_info` | 内存详细信息 | 低 | P2扩展 |
| `get_disk_info` | 磁盘详细信息 | 低 | P2扩展 |
| `get_network_info` | 网络详细信息 | 低 | P2扩展 |

**安全限制**：
- 结束进程需二次确认
- 禁止操作系统关键进程

### 2.3 对话历史管理

#### 2.3.1 需求说明

实现对话历史的持久化存储，支持：
- 多会话管理（创建、删除、切换）
- 历史消息存储和查询
- 会话元数据（标题、时间、消息数）
- 会话恢复（断点续聊）

#### 2.3.2 数据库设计

**表结构**：

```sql
-- 会话表
CREATE TABLE sessions (
    id TEXT PRIMARY KEY,           -- UUID
    title TEXT NOT NULL,           -- 会话标题
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    message_count INTEGER DEFAULT 0,
    is_archived BOOLEAN DEFAULT FALSE,
    metadata JSON                  -- 扩展字段
);

-- 消息表
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT NOT NULL,
    role TEXT NOT NULL CHECK(role IN ('user', 'assistant', 'system')),
    content TEXT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    execution_steps JSON,          -- ReAct执行步骤（AI消息）
    metadata JSON,                 -- 扩展字段（token数、模型等）
    FOREIGN KEY (session_id) REFERENCES sessions(id) ON DELETE CASCADE
);

-- 索引
CREATE INDEX idx_messages_session ON messages(session_id, timestamp);
CREATE INDEX idx_sessions_updated ON sessions(updated_at DESC);
```

#### 2.3.3 功能清单

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 创建会话 | 新建对话会话 | P0 |
| 获取会话列表 | 分页查询会话 | P0 |
| 获取会话消息 | 查询某会话的所有消息 | P0 |
| 删除会话 | 软删除/硬删除 | P0 |
| 更新会话标题 | 修改会话标题 | P1 |
| 归档会话 | 归档不常用的会话 | P2 |
| 搜索会话 | 按关键词搜索 | P2 |
| 会话恢复 | 从某条消息继续对话 | P2 |

---

## 3. 技术方案

### 3.1 后端技术方案

#### 3.1.1 数据库选型

**选择SQLite**：
- ✅ 零配置，无需独立服务
- ✅ 单文件存储，便于备份和迁移
- ✅ Python原生支持（sqlite3）
- ✅ 足够支撑个人级应用

**数据库文件位置**：
```
OmniAgentAs-desk/
├── data/
│   └── sessions.db    # SQLite数据库文件
```

#### 3.1.2 工具服务架构

```
backend/app/services/
├── tools/                    # 工具服务目录
│   ├── __init__.py
│   ├── base.py              # 工具基类
│   ├── file_tools.py        # 文件操作工具（P0，已存在）
│   ├── window_tools.py      # 窗口管理工具（P1，阶段2.2新增）
│   ├── screenshot_tools.py  # 截图工具（P1，阶段2.2新增）
│   ├── shell_tools.py       # Shell工具（P1，阶段2.2扩展）
│   ├── system_tools.py      # 系统信息工具（P2，阶段2.2新增）
│   └── clipboard_tools.py   # 剪贴板工具（P2，阶段2.2新增）
├── database/                 # 数据库服务
│   ├── __init__.py
│   ├── connection.py        # 数据库连接管理
│   ├── session_repository.py # 会话数据访问
│   └── message_repository.py # 消息数据访问
└── ...
```

#### 3.1.3 工具基类设计

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, Optional
from pydantic import BaseModel

class ToolParameters(BaseModel):
    """工具参数基类"""
    pass

class ToolResult(BaseModel):
    """工具结果基类"""
    success: bool
    message: str
    data: Optional[Dict[str, Any]] = None

class BaseTool(ABC):
    """工具基类"""
    
    name: str
    description: str
    parameters_schema: type[ToolParameters]
    
    # 安全级别
    SAFETY_LOW = "low"      # 只读查询
    SAFETY_MEDIUM = "medium" # 有限修改
    SAFETY_HIGH = "high"     # 系统级操作
    safety_level: str = SAFETY_LOW
    
    @abstractmethod
    async def execute(self, params: ToolParameters) -> ToolResult:
        """执行工具"""
        pass
    
    def validate_params(self, params: dict) -> ToolParameters:
        """参数校验"""
        return self.parameters_schema(**params)
    
    def requires_confirmation(self) -> bool:
        """是否需要二次确认"""
        return self.safety_level in [self.SAFETY_MEDIUM, self.SAFETY_HIGH]
```

#### 3.1.4 API接口设计

**会话管理API**：

```yaml
# 创建会话
POST /api/v1/sessions
Request:
  title: string  # 可选，默认"新会话"
Response:
  session_id: string
  title: string
  created_at: string

# 获取会话列表
GET /api/v1/sessions?page=1&page_size=20
Response:
  total: number
  sessions: [
    {
      id: string
      title: string
      created_at: string
      updated_at: string
      message_count: number
    }
  ]

# 获取会话消息
GET /api/v1/sessions/{session_id}/messages
Response:
  session_id: string
  messages: [
    {
      id: number
      role: "user" | "assistant" | "system"
      content: string
      timestamp: string
      execution_steps: object  # AI消息有此项
    }
  ]

# 删除会话
DELETE /api/v1/sessions/{session_id}
Response:
  success: boolean

# 更新会话标题
PUT /api/v1/sessions/{session_id}
Request:
  title: string
```

**工具执行API**：

```yaml
# 执行工具（扩展现有API）
POST /api/v1/tools/execute
Request:
  tool_name: string
  parameters: object
  require_confirmation: boolean  # 是否已确认
Response:
  success: boolean
  result: object
  need_confirmation: boolean     # 是否需要二次确认
  confirmation_message: string   # 确认提示信息
```

### 3.2 前端技术方案

#### 3.2.1 组件扩展

在阶段2.1基础上，新增/修改组件：

```
frontend/src/
├── components/
│   ├── Chat/
│   │   └── ...（阶段2.1已有）
│   ├── History/                 # 新增：历史会话管理
│   │   ├── SessionList.tsx     # 会话列表
│   │   ├── SessionItem.tsx     # 会话项
│   │   └── SessionSearch.tsx   # 会话搜索
│   ├── Tools/                   # 新增：工具执行展示
│   │   ├── ToolExecution.tsx   # 工具执行面板
│   │   ├── WindowInfo.tsx      # 窗口信息展示
│   │   ├── ScreenshotResult.tsx # 截图结果展示
│   │   └── SystemInfo.tsx      # 系统信息展示
│   └── ...
├── services/
│   └── api.ts                   # 扩展：添加会话API
├── hooks/
│   └── useSessions.ts          # 新增：会话管理Hook
└── types/
    └── session.ts              # 新增：会话类型定义
```

#### 3.2.2 状态管理扩展

**SessionContext**：管理当前会话状态

```typescript
interface SessionContextType {
  // 当前会话
  currentSession: Session | null;
  setCurrentSession: (session: Session | null) => void;
  
  // 会话列表
  sessions: Session[];
  loadingSessions: boolean;
  refreshSessions: () => Promise<void>;
  
  // 消息
  messages: Message[];
  loadingMessages: boolean;
  loadMessages: (sessionId: string) => Promise<void>;
  
  // 操作
  createSession: (title?: string) => Promise<Session>;
  deleteSession: (sessionId: string) => Promise<void>;
  updateSessionTitle: (sessionId: string, title: string) => Promise<void>;
}
```

#### 3.2.3 界面设计

**历史会话侧边栏**：

```
┌─────────────────────────────────────────────────────────┐
│ 📁 文件    💬 历史    ⚙️ 设置                          │
├─────────────────────────────────────────────────────────┤
│ 🔍 搜索会话...                                          │
├─────────────────────────────────────────────────────────┤
│ ➕ 新建会话                                             │
├─────────────────────────────────────────────────────────┤
│ 💬 项目需求分析                          2小时前        │
│ 💬 代码重构方案                          昨天           │
│ 💬 Python学习笔记                        3天前         │
│ ...                                                     │
└─────────────────────────────────────────────────────────┘
```

**工具执行面板**：

```
┌─────────────────────────────────────────────────────────┐
│ 🛠️ 工具执行                                            │
├─────────────────────────────────────────────────────────┤
│ 执行: screenshot_full                                   │
│ 状态: ✅ 成功                                           │
│ 结果:                                                   │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [截图预览]                                          │ │
│ │ /tmp/screenshot_20240218_174608.png                 │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 数据库详细设计

### 4.1 实体关系图

```
┌──────────────┐       ┌──────────────┐
│   sessions   │ 1   N │   messages   │
├──────────────┤───────┼──────────────┤
│ id (PK)      │       │ id (PK)      │
│ title        │       │ session_id   │
│ created_at   │       │ role         │
│ updated_at   │       │ content      │
│ message_count│       │ timestamp    │
│ is_archived  │       │ execution_   │
│ metadata     │       │   steps      │
└──────────────┘       │ metadata     │
                       └──────────────┘
```

### 4.2 完整SQL Schema

```sql
-- ============================================
-- OmniAgentAst 会话管理数据库 Schema
-- 版本: v1.0
-- 创建时间: 2026-02-18
-- ============================================

-- 会话表
CREATE TABLE IF NOT EXISTS sessions (
    id TEXT PRIMARY KEY,
    title TEXT NOT NULL DEFAULT '新会话',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    message_count INTEGER DEFAULT 0,
    is_archived BOOLEAN DEFAULT 0,
    metadata TEXT  -- JSON格式
);

-- 消息表
CREATE TABLE IF NOT EXISTS messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT NOT NULL,
    role TEXT NOT NULL CHECK(role IN ('user', 'assistant', 'system')),
    content TEXT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    execution_steps TEXT,  -- JSON格式，存储ReAct执行步骤
    metadata TEXT,         -- JSON格式
    FOREIGN KEY (session_id) REFERENCES sessions(id) ON DELETE CASCADE
);

-- 索引
CREATE INDEX IF NOT EXISTS idx_messages_session_time 
    ON messages(session_id, timestamp);

CREATE INDEX IF NOT EXISTS idx_sessions_updated 
    ON sessions(updated_at DESC);

-- 触发器：自动更新会话消息数
CREATE TRIGGER IF NOT EXISTS update_message_count
AFTER INSERT ON messages
BEGIN
    UPDATE sessions 
    SET message_count = message_count + 1,
        updated_at = CURRENT_TIMESTAMP
    WHERE id = NEW.session_id;
END;

-- 触发器：自动更新会话更新时间
CREATE TRIGGER IF NOT EXISTS update_session_timestamp
AFTER UPDATE ON sessions
BEGIN
    UPDATE sessions 
    SET updated_at = CURRENT_TIMESTAMP
    WHERE id = NEW.id;
END;
```

---

## 5. 验收标准

### 5.1 功能验收

| AC编号 | 验收项 | 验收标准 | 优先级 |
|--------|--------|----------|--------|
| AC001 | 窗口列表获取 | `list_windows`返回当前所有窗口信息 | P1 |
| AC002 | 窗口切换 | `switch_window`成功切换到指定窗口 | P1 |
| AC003 | 截图功能 | `screenshot_full`成功保存截图并返回路径 | P1 |
| AC004 | Shell执行 | `run_shell`执行安全命令并返回结果 | P1 |
| AC005 | Shell安全 | 危险命令被拦截并返回错误 | P1 |
| AC006 | 系统信息 | `get_system_info`返回准确的系统信息 | P2 |
| AC007 | 剪贴板操作 | 桌面版可读写剪贴板内容 | P2 |
| AC008 | 会话创建 | 可创建新会话并返回ID | P0 |
| AC009 | 会话列表 | 可分页获取会话列表 | P0 |
| AC010 | 消息存储 | 对话消息正确存储到数据库 | P0 |
| AC011 | 消息查询 | 可查询会话的所有历史消息 | P0 |
| AC012 | 会话删除 | 可删除会话及其所有消息 | P0 |

### 5.2 性能验收

| 验收项 | 标准 |
|--------|------|
| 会话列表查询 | < 100ms（100个会话） |
| 消息查询 | < 200ms（1000条消息） |
| 截图保存 | < 500ms |
| Shell执行 | < 5s（默认超时30s） |
| 数据库初始化 | < 1s |

### 5.3 安全验收

| 验收项 | 标准 |
|--------|------|
| 危险命令拦截 | 100%拦截黑名单命令 |
| 窗口关闭确认 | 关闭窗口前弹窗确认 |
| 进程结束确认 | 结束进程前弹窗确认 |
| 数据隔离 | 会话数据不泄露 |

---

## 6. 开发计划

### 6.1 任务分解

| 序号 | 任务 | 负责人 | 估计工时 | 依赖 | 说明 |
|------|------|--------|----------|------|------|
| **后端开发** | | | | | |
| 1 | 数据库模块 | 小沈 | 4h | - | SQLite连接、会话/消息表 |
| 2 | 窗口管理工具 | 小沈 | 4h | - | list_windows, switch_window |
| 3 | 截图工具 | 小沈 | 3h | - | screenshot（全屏/窗口模式） |
| 4 | Shell工具增强 | 小沈 | 2h | 阶段2.1基础 | 与配置系统集成白名单 |
| 5 | 系统信息工具 | 小沈 | 2h | - | get_system_info |
| 6 | 剪贴板工具 | 小沈 | 2h | - | clipboard_read/write |
| 7 | 会话管理API | 小沈 | 4h | 数据库模块 | 6个REST接口 |
| **前端开发** | | | | | |
| 8 | 会话管理组件 | 小新 | 4h | API就绪 | useSessions Hook |
| 9 | 历史会话界面 | 小新 | 4h | 会话组件 | SessionList/SessionItem |
| 10 | 工具执行展示 | 小新 | 3h | - | WindowInfo/ScreenshotResult等 |
| 11 | 系统集成 | 小新 | 3h | 全部完成 | 与阶段2.1界面集成 |
| **测试** | | | | | |
| 12 | 单元测试 | 小沈/小新 | 4h | - | 工具测试、API测试 |
| 13 | 集成测试 | 联调 | 2h | - | 前后端联调 |
| **总计** | | | **37h** | | |

**说明**：
- 工时估算基于功能范围严格控制后的评估
- create_directory和delete_file已在阶段1.3实现，阶段2.2仅做集成和增强
- 进程管理、详细系统信息工具不在本阶段范围

### 6.2 里程碑

| 里程碑 | 时间 | 交付物 | 验收标准 |
|--------|------|--------|---------|
| M1 | 第1天 | 数据库模块 | sessions表、messages表创建，触发器工作正常 |
| M2 | 第2天 | 会话管理API | 6个API接口全部实现并通过单元测试 |
| M3 | 第3天 | P1级工具 | list_windows、switch_window、screenshot、run_shell完成 |
| M4 | 第4天 | P2级工具 | get_system_info、clipboard工具完成 |
| M5 | 第5天 | 前端界面 | SessionList组件、历史会话界面完成 |
| M6 | 第6天 | 集成测试 | 前后端联调通过，12项AC全部验收 |

**总计周期**: 6天（37工时）

---

## 7. 风险分析

### 7.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 跨平台窗口管理差异大 | 中 | 高 | 优先实现Windows，其他平台后续支持 |
| 截图权限问题 | 中 | 中 | 添加权限申请和错误处理 |
| SQLite并发性能 | 低 | 中 | 单用户使用场景，足够支撑 |
| Web版功能受限 | 高 | 低 | 文档说明Web版限制 |

### 7.2 安全风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| Shell命令注入 | 低 | 高 | 黑名单+白名单双重验证 |
| 进程误杀 | 低 | 高 | 系统进程保护+二次确认 |
| 敏感信息截图 | 低 | 中 | 用户授权机制 |

---

## 8. 依赖和约束

### 8.1 前置依赖

- ✅ 阶段2.1 Web对话界面（已完成）
- ✅ 阶段2.1 配置管理（已完成）
- ✅ 阶段2.1 安全框架（已完成）

### 8.2 技术约束

- **后端**：Python 3.11+, FastAPI, SQLite
- **前端**：React 18, TypeScript, Ant Design 5
- **平台**：Windows优先，支持macOS/Linux

### 8.3 新增依赖

```python
# requirements.txt 新增
pywin32>=306; platform_system=="Windows"  # Windows API
pyperclip>=1.8.2                          # 剪贴板
psutil>=5.9.0                             # 系统信息
Pillow>=10.0.0                            # 截图
```

---

## 9. 附录

### 9.1 参考文档

- [阶段2.1设计文档](doc/阶段2.1-Web版设计文档-2026-02-17.md)
- [开发优先级计划](doc/桌面omni开发优先级计划.md)
- [阶段跟踪表](doc/桌面omni阶段跟踪表.md)

### 9.2 术语表

| 术语 | 说明 |
|------|------|
| P0工具 | 核心文件操作工具（阶段1.3） |
| P1工具 | 系统级工具（窗口、截图、Shell） |
| P2工具 | 辅助工具（剪贴板、系统信息） |
| ReAct | 思考-行动-观察循环模式 |
| Win32 API | Windows系统编程接口 |

---

## 10. 参考文档

### 10.1 前置阶段文档
- [阶段2.1设计文档](../doc/阶段2.1-Web版设计文档-2026-02-17.md)
- [阶段2.1开发执行计划](../doc/阶段2.1-开发执行计划-2026-02-17.md)

### 10.2 项目规划文档
- [开发优先级计划v1.1](../doc/桌面omni开发优先级计划.md)
- [阶段跟踪表v0.3.2](../doc/桌面omni阶段跟踪表.md)

### 10.3 设计约束说明

**严格遵循的约束**：
1. **P1级工具**：严格按照开发优先级计划第2.2.1节定义的6个工具
2. **P2级工具**：按计划定义，实现方案可细化但功能范围不变
3. **历史管理**：SQLite数据库，单文件存储，零配置
4. **技术栈**：与阶段2.1保持一致（Python 3.11+, FastAPI, React 18, TypeScript）

**设计一致性检查**：
- [x] 工具命名与阶段1.3/2.1保持一致
- [x] API接口风格与阶段2.1保持一致（RESTful, YAML定义）
- [x] 数据库Schema设计符合SQLite最佳实践
- [x] 安全机制与阶段2.1安全框架兼容

---

**文档编写人**: 小沈  
**审核人**: 北京老陈  

## 版本历史

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2026-02-18 18:00:00 | 初始版本，修正工具列表与计划一致，移除超范围功能 | 小沈 |
