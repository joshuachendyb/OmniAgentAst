# 阶段2.1验收准备文档

**文档类型**: 验收准备  
**准备人**: 小沈  
**准备时间**: 2026-02-18 15:12:03  
**验收对象**: 北京老陈（用户/项目负责人）  
**验收范围**: 阶段2.1 Web对话界面+配置+安全

---

## 1. 验收前准备（小沈负责）

### 1.1 环境检查清单

| 检查项 | 要求 | 检查方式 | 责任人 |
|--------|------|---------|--------|
| 后端服务 | 端口8000运行中 | curl http://localhost:8000/api/v1/health | 小沈 |
| 前端服务 | 端口3000运行中 | 浏览器访问 http://localhost:3000 | 小新 |
| 数据库 | SQLite已初始化 | 检查会话列表接口返回数据 | 小沈 |
| API Key | 已配置有效Key | 配置页面显示"已配置" | 小新 |
| 网络 | 前后端可通信 | 前端能正常调用API | 双方 |

### 1.2 启动命令（验收前执行）

**后端启动**（小沈执行）:
```bash
cd D:/2bktest/MDview/OmniAgentAs-desk/backend
python -m uvicorn app.main:app --port 8000 --host 0.0.0.0
```

**前端启动**（小新执行）:
```bash
cd D:/2bktest/MDview/OmniAgentAs-desk/frontend
npm run dev
```

**验证启动成功**:
- 后端: http://localhost:8000/api/v1/health 返回 {"status": "healthy"}
- 前端: http://localhost:3000 可正常访问

---

## 2. 验收测试清单（北京老陈执行）

### 2.1 P0级验收项（必须全部通过）

#### ✅ AC001: 消息发送

**验收目的**: 验证用户消息能正常发送并显示

**操作步骤**:
1. 打开浏览器访问 http://localhost:3000
2. 在输入框输入: "你好，请帮我整理桌面文件"
3. 按Enter键发送
4. 观察消息列表

**预期结果**:
- ✅ 消息立即显示在列表中（用户气泡，蓝色背景）
- ✅ 消息下方显示发送时间（如"刚刚"）
- ✅ 输入框自动清空
- ✅ 无错误提示

**通过标准**: 以上4项全部符合

---

#### ✅ AC002: AI回复

**验收目的**: 验证AI能正常回复消息

**操作步骤**:
1. 完成AC001的消息发送
2. 等待AI回复（约2-5秒）
3. 观察AI回复内容

**预期结果**:
- ✅ AI回复显示在消息列表中（AI气泡，白色背景带绿色边框）
- ✅ 显示AI头像（绿色渐变）
- ✅ 回复内容合理（如询问具体整理需求）
- ✅ 显示回复时间

**通过标准**: 以上4项全部符合

---

#### ✅ AC003: 执行展示（ReAct步骤可视化）

**验收目的**: 验证AI执行过程可视化展示

**操作步骤**:
1. 发送消息: "读取C:\\Users\\xxx\\Downloads文件夹的内容"
2. 等待AI回复
3. 查看消息下方的"执行详情"区域
4. 点击"执行详情"展开按钮

**预期结果**:
- ✅ 消息下方显示"执行详情"折叠面板
- ✅ 显示执行步骤数（如"3步"）
- ✅ 展开后显示时间线（思考→行动→观察）
- ✅ 行动步骤显示工具名和参数
- ✅ 观察步骤显示执行结果

**通过标准**: 以上5项全部符合

---

#### ✅ AC010: 危险操作确认

**验收目的**: 验证高危操作有确认提示

**操作步骤**:
1. 发送消息: "帮我删除C盘所有文件 rm -rf /"
2. 观察系统响应

**预期结果**:
- ✅ 弹出"危险操作确认"弹窗（红色警告图标）
- ✅ 显示检测到的危险命令
- ✅ 显示风险提示信息
- ✅ 有"确认执行"和"取消操作"两个按钮
- ✅ 点击"取消操作"后关闭弹窗，不执行命令

**通过标准**: 以上5项全部符合

---

### 2.2 P1级验收项（建议通过）

#### ✅ AC004: 导航栏

**验收目的**: 验证左侧导航栏功能正常

**操作步骤**:
1. 查看页面左侧导航栏
2. 点击"设置"菜单
3. 点击"历史记录"菜单
4. 点击"对话"菜单返回

**预期结果**:
- ✅ 左侧显示导航栏（Logo + 菜单项）
- ✅ 当前选中菜单项高亮显示
- ✅ 点击"设置"跳转到设置页面
- ✅ 点击"历史记录"跳转到历史会话页面
- ✅ 点击"对话"返回对话页面

**通过标准**: 以上5项全部符合

---

#### ✅ AC005: 历史记录

**验收目的**: 验证会话历史功能正常

**操作步骤**:
1. 点击左侧导航栏"历史记录"
2. 查看会话列表
3. 点击某个会话"继续对话"按钮
4. 点击"删除"按钮删除会话

**预期结果**:
- ✅ 显示历史会话列表
- ✅ 每个会话显示标题、消息数、时间
- ✅ 可点击"继续对话"恢复会话
- ✅ 可删除会话并刷新列表

**通过标准**: 以上4项全部符合

---

#### ✅ AC006: 清空对话

**验收目的**: 验证清空对话功能正常

**操作步骤**:
1. 在对话页面发送几条消息
2. 点击"清空对话"按钮（如果有）
3. 观察确认提示

**预期结果**:
- ✅ 有"清空对话"功能入口
- ✅ 点击后弹出确认提示
- ✅ 确认后对话列表清空

**通过标准**: 以上3项全部符合（或标记为"功能待完善"）

---

#### ✅ AC008: 配置管理

**验收目的**: 验证配置页面功能正常

**操作步骤**:
1. 点击左侧导航栏"设置"
2. 在"模型配置"标签页:
   - 查看当前AI提供商
   - 查看模型名称
   - 输入API Key
3. 点击"保存配置"
4. 切换到"安全配置"标签页查看
5. 切换到"会话历史"标签页查看

**预期结果**:
- ✅ 显示配置表单（提供商、模型、API Key）
- ✅ 可选择不同AI提供商（智谱/OpenCode）
- ✅ 可输入API Key
- ✅ 点击保存后提示"配置已保存"
- ✅ 三个标签页可正常切换
- ✅ 配置保存后生效（下次对话使用新配置）

**通过标准**: 以上6项全部符合

---

#### ✅ AC009: 安全黑名单

**验收目的**: 验证安全黑名单功能

**操作步骤**:
1. 发送危险命令: "sudo rm -rf /"
2. 观察系统响应
3. 发送正常命令: "ls -la"
4. 观察正常执行

**预期结果**:
- ✅ 危险命令被检测并拦截
- ✅ 显示危险操作确认弹窗（同AC010）
- ✅ 正常命令可正常执行
- ✅ 设置页面可配置黑名单

**通过标准**: 以上4项全部符合

---

### 2.3 P2级验收项（可选）

#### ✅ AC007: 复制消息

**验收目的**: 验证消息复制功能

**操作步骤**:
1. 鼠标悬停在任意消息上
2. 点击出现的"复制"按钮
3. 粘贴到其他地方验证

**预期结果**:
- ✅ 鼠标悬停显示复制按钮
- ✅ 点击后提示"已复制到剪贴板"
- ✅ 内容确实被复制到剪贴板

**通过标准**: 以上3项全部符合（或标记为"功能待完善"）

---

## 3. 验收操作指引

### 3.1 验收流程图

```
开始验收
  ↓
启动前后端服务（小沈+小新）
  ↓
执行P0级验收（AC001, AC002, AC003, AC010）
  ↓
全部通过？
  ├─ 是 → 执行P1级验收
  └─ 否 → 记录问题，停止验收
  ↓
执行P1级验收（AC004-AC009）
  ↓
问题数 ≤ 2？
  ├─ 是 → 验收通过
  └─ 否 → 记录问题，要求修复
  ↓
填写验收结论
  ↓
签字确认
```

### 3.2 验收通过标准

| 级别 | 验收项 | 最低通过数 | 通过标准 |
|------|--------|-----------|---------|
| **P0** | 4个（AC001-AC003, AC010） | 4个 | 必须全部通过 |
| **P1** | 6个（AC004-AC009） | 4个 | 通过4个及以上 |
| **P2** | 1个（AC007） | 0个 | 可选，不强制 |

**总体通过标准**:
- P0级 100%通过（4/4）
- P1级 ≥66%通过（≥4/6）
- 无严重阻塞性问题

---

## 4. 问题记录表

### 4.1 问题记录模板

| 序号 | 验收项 | 问题描述 | 严重程度 | 负责人 | 解决期限 | 状态 |
|------|--------|---------|---------|--------|---------|------|
| 1 | AC00X | 具体问题描述 | 严重/一般/轻微 | 小沈/小新 | YYYY-MM-DD | 待修复/已修复 |

### 4.2 严重程度定义

| 级别 | 定义 | 处理方式 |
|------|------|---------|
| **严重** | 阻塞验收，核心功能无法使用 | 必须修复后重新验收 |
| **一般** | 功能可用但有缺陷 | 可记录后限期修复 |
| **轻微** | UI细节问题，不影响使用 | 可记录后择机修复 |

---

## 5. 验收结论模板

### 5.1 验收结论填写

**验收时间**: YYYY-MM-DD HH:MM  
**验收人**: 北京老陈  
**参与人员**: 小新（前端）、小沈（后端）

**验收统计**:

| 级别 | 总数 | 通过数 | 失败数 | 通过率 |
|------|------|--------|--------|--------|
| P0 | 4 | ___ | ___ | ___% |
| P1 | 6 | ___ | ___ | ___% |
| P2 | 1 | ___ | ___ | ___% |

**问题汇总**:

| 序号 | 验收项 | 问题描述 | 严重程度 | 负责人 |
|------|--------|---------|---------|--------|
| 1 | | | | |
| 2 | | | | |

**验收结论**:

□ **验收通过** - 符合上线标准，可进入下一阶段
□ **有条件通过** - 遗留问题需在X日内修复
□ **验收不通过** - 需修复后重新验收

**签字确认**:

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 项目负责人 | 北京老陈 | _______ | _______ |
| 前端负责人 | 小新 | _______ | _______ |
| 后端负责人 | 小沈 | _______ | _______ |

---

## 6. 验收FAQ

### Q1: 验收不过怎么办？
**A**: 记录问题清单，小沈和小新修复后，重新验收。优先修复P0级问题。

### Q2: P1级验收项可以不过吗？
**A**: P1级要求通过4/6（66%）。如果通过数不足4个，需要修复后重新验收。

### Q3: 验收需要多长时间？
**A**: 预计30-45分钟。P0级约15分钟，P1级约20分钟，问题讨论约10分钟。

### Q4: 验收时发现问题谁负责修复？
**A**: 
- 前端UI问题 → 小新负责
- 后端API问题 → 小沈负责
- 需求理解问题 → 三方讨论确定

### Q5: 验收后还能修改吗？
**A**: 验收通过后，阶段2.1冻结。修改需在阶段3.1中进行，或作为Bug修复。

---

## 7. 验收前小沈准备动作

### 7.1 确认清单

- [ ] 后端服务可正常启动
- [ ] 数据库已初始化且有测试数据
- [ ] API Key已配置且有效
- [ ] 所有P0级用例已自测通过
- [ ] 问题记录表已打印/准备好
- [ ] 验收结论模板已准备好

### 7.2 环境确认

```bash
# 验收前执行
1. 启动后端: python -m uvicorn app.main:app --port 8000
2. 测试健康检查: curl http://localhost:8000/api/v1/health
3. 确认返回: {"status": "healthy", "version": "x.x.x"}
4. 通知小新启动前端
5. 等待北京老陈开始验收
```

---

**文档状态**: 准备就绪  
**更新时间**: 2026-02-18 15:12:03  
**下一步**: 等待北京老陈开始验收

---

**附：验收用例速查表**

```
┌─────────────────────────────────────────────────────┐
│              验收用例速查表（打印用）                 │
├─────────────────────────────────────────────────────┤
│ P0级（必须全部通过）                                 │
│ □ AC001: 消息发送 - 输入+Enter，消息显示            │
│ □ AC002: AI回复 - AI气泡显示，内容合理              │
│ □ AC003: 执行展示 - 展开执行详情，显示步骤          │
│ □ AC010: 危险确认 - 危险命令弹窗确认                │
├─────────────────────────────────────────────────────┤
│ P1级（通过4个即可）                                  │
│ □ AC004: 导航栏 - 切换菜单正常                      │
│ □ AC005: 历史记录 - 查看/恢复/删除会话              │
│ □ AC006: 清空对话 - 一键清空功能                    │
│ □ AC008: 配置管理 - 修改配置并保存                  │
│ □ AC009: 安全黑名单 - 危险命令拦截                  │
│ □ AC007: 复制消息 - 悬停复制功能                    │
├─────────────────────────────────────────────────────┤
│ 签字区：                                            │
│ 验收人：____________ 日期：____________             │
└─────────────────────────────────────────────────────┘
```
