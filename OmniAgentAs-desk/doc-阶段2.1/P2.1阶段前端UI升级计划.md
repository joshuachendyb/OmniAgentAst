# P2.1阶段前端UI升级计划

**文档版本**: v1.0  
**创建时间**: 2026-02-19 23:43:26  
**计划周期**: 8个工作日  
**负责人**: 小新（前端开发）  
**存放位置**: D:\2bktest\MDview\OmniAgentAs-desk\doc-阶段2.1\

---

## 一、计划目标

完成阶段2.1前端UI开发，确保通过P0级验收（必须100%通过）和P1级验收（通过4/6项）。

---

## 二、任务清单与验收项对照

### P0级任务（必须全部完成）

| 序号 | 任务名称 | 工时 | 验收项 | 状态 |
|------|---------|------|--------|------|
| 1 | **消息组件美化** | 4h | AC001(消息发送) + AC002(AI回复) | ⏳ 待执行 |
| 2 | **ExecutionPanel组件** | 8h | AC003(执行展示) | ⏳ 待执行 |
| 3 | **危险操作弹窗** | 4h | AC010(危险确认) | ⏳ 待执行 |
| 4 | **流式API对接** | 6h | AC002(AI回复) + AC003(执行展示) | ⏳ 待执行 |

### P1级任务（完成4/6即可）

| 序号 | 任务名称 | 工时 | 验收项 | 状态 |
|------|---------|------|--------|------|
| 5 | **Layout布局重构** | 4h | AC004(导航栏)基础 | ⏳ 待执行 |
| 6 | **Sidebar导航栏** | 4h | AC004(导航栏)功能 | ⏳ 待执行 |
| 7 | **设置页面** | 6h | AC008(配置管理) | ⏳ 待执行 |
| 8 | **历史会话页面** | 6h | AC005(历史记录) | ⏳ 待执行 |
| 9 | **消息复制功能** | 2h | AC007(复制消息) | ⏳ 待执行 |
| 10 | **前端单元测试** | 8h | 代码质量要求 | ⏳ 待执行 |

---

## 三、执行计划（8天）

### Day 1: 消息组件美化 + Layout布局重构
**目标**: 完成基础UI框架和消息组件

**上午（4h）**: Layout布局重构
- [ ] 创建Layout/index.tsx组件
- [ ] 实现左右分栏布局（Sider 220px + Content自适应）
- [ ] 配置路由（/chat, /settings, /history）
- [ ] 应用Ant Design 5样式

**下午（4h）**: 消息组件美化
- [ ] 重构MessageItem组件
- [ ] 用户消息：蓝色渐变背景 + 右侧圆角
- [ ] AI消息：白色卡片 + 绿色边框 + 左侧圆角
- [ ] 添加头像组件（User蓝色/AI绿色）
- [ ] 时间戳显示（相对时间格式）

**交付物**:
- Layout组件可正常运行
- 消息气泡样式符合设计规范

---

### Day 2: ExecutionPanel组件
**目标**: 完成执行过程可视化

**上午（4h）**: 组件框架
- [ ] 创建ExecutionPanel/index.tsx
- [ ] 实现可折叠卡片（Collapse组件）
- [ ] 添加步骤计数显示

**下午（4h）**: 时间线实现
- [ ] 使用Timeline组件展示执行步骤
- [ ] 思考步骤：灰色斜体文字
- [ ] 行动步骤：卡片展示工具名和参数
- [ ] 观察步骤：绿色结果展示
- [ ] 完成步骤：对勾图标

**交付物**:
- ExecutionPanel组件可正常展示ReAct步骤
- 支持展开/折叠操作

---

### Day 3: 危险操作弹窗 + 流式API准备
**目标**: 完成安全功能和流式API准备

**上午（4h）**: 危险操作弹窗
- [ ] 创建DangerConfirmModal组件
- [ ] 红色警告图标 + 标题
- [ ] 命令内容展示（红色背景代码块）
- [ ] 确认/取消按钮（确认按钮danger样式）
- [ ] 风险提示信息展示

**下午（4h）**: 流式API准备
- [ ] 封装EventSource API调用
- [ ] 定义ExecutionStep类型接口
- [ ] 实现消息流处理Hook
- [ ] 测试与后端SSE连接

**交付物**:
- DangerConfirmModal可正常弹窗
- 流式API连接正常

---

### Day 4: 流式API对接 + Sidebar导航栏
**目标**: 完成流式输出和导航栏

**上午（4h）**: 流式API对接
- [ ] Chat组件集成流式响应
- [ ] 实时显示AI思考过程
- [ ] 工具调用结果实时更新
- [ ] 最终消息合并显示

**下午（4h）**: Sidebar导航栏
- [ ] 创建Sidebar组件
- [ ] Logo区域设计
- [ ] 菜单项（对话/文件/知识库/历史/设置）
- [ ] 当前路由高亮显示
- [ ] 未读消息badge提示

**交付物**:
- 流式输出正常工作
- 导航栏可正常切换

---

### Day 5: 设置页面
**目标**: 完成配置管理界面

**上午（4h）**: 页面框架
- [ ] 创建SettingsPage组件
- [ ] 三个标签页（AI设置/外观设置/安全设置）
- [ ] 表单布局设计

**下午（4h）**: 功能实现
- [ ] AI提供商选择（智谱/OpenCode）
- [ ] API Key输入框（密码类型）
- [ ] 验证Key按钮及状态显示
- [ ] 主题切换（亮色/暗色）
- [ ] 保存配置功能

**交付物**:
- 设置页面功能完整
- 配置可正常保存

---

### Day 6: 历史会话页面
**目标**: 完成历史记录功能

**上午（4h）**: 页面框架
- [ ] 创建HistoryPage组件
- [ ] 搜索框组件
- [ ] 会话列表展示（List组件）

**下午（4h）**: 功能实现
- [ ] 会话标题、消息数、时间显示
- [ ] "继续对话"按钮功能
- [ ] "删除"按钮及确认弹窗
- [ ] 搜索过滤功能

**交付物**:
- 历史记录页面功能完整
- 可正常恢复和删除会话

---

### Day 7: 消息复制功能 + 优化完善
**目标**: 完成剩余功能并优化

**上午（2h）**: 消息复制功能
- [ ] 消息悬停显示复制按钮
- [ ] 点击复制到剪贴板
- [ ] 复制成功提示

**下午（6h）**: 优化完善
- [ ] 性能优化（React.memo等）
- [ ] 错误处理完善
- [ ] 加载状态优化
- [ ] 响应式适配检查

**交付物**:
- 复制功能可用
- 整体体验优化

---

### Day 8: 前端单元测试
**目标**: 完成测试覆盖

**上午（4h）**: 组件测试
- [ ] Layout组件测试
- [ ] MessageItem组件测试
- [ ] ExecutionPanel组件测试
- [ ] DangerConfirmModal组件测试

**下午（4h）**: 其他测试
- [ ] Hooks测试
- [ ] API服务测试
- [ ] 测试覆盖率检查（目标>80%）
- [ ] 修复测试发现的问题

**交付物**:
- 单元测试覆盖率>80%
- 所有测试通过

---

## 四、验收标准对照

### P0级验收项（必须100%通过）

| 验收项 | 要求 | 对应任务 | 状态 |
|--------|------|---------|------|
| **AC001**: 消息发送 | 输入+Enter，消息显示，时间戳正确 | 任务1 | ⏳ Day1 |
| **AC002**: AI回复 | AI气泡显示，内容合理，流式输出 | 任务1+4 | ⏳ Day1+4 |
| **AC003**: 执行展示 | 展开执行详情，显示步骤时间线 | 任务2 | ⏳ Day2 |
| **AC010**: 危险确认 | 危险命令弹窗确认，取消不执行 | 任务3 | ⏳ Day3 |

### P1级验收项（需通过4/6项）

| 验收项 | 要求 | 对应任务 | 状态 |
|--------|------|---------|------|
| **AC004**: 导航栏 | 切换菜单正常，当前项高亮 | 任务5+6 | ⏳ Day1+4 |
| **AC005**: 历史记录 | 查看/恢复/删除会话正常 | 任务8 | ⏳ Day6 |
| **AC006**: 清空对话 | 一键清空功能（如有时） | - | 可选 |
| **AC007**: 复制消息 | 悬停复制功能 | 任务9 | ⏳ Day7 |
| **AC008**: 配置管理 | 修改配置并保存生效 | 任务7 | ⏳ Day5 |
| **AC009**: 安全黑名单 | 危险命令拦截（配合小沈） | 任务3 | ⏳ Day3 |

---

## 五、技术规范

### 5.1 样式规范
- **设计体系**: Ant Design 5
- **主色**: #1890ff
- **背景**: 渐变背景 + 卡片阴影
- **动画**: 消息淡入200ms，按钮微交互

### 5.2 代码规范
- **语言**: TypeScript
- **组件**: 函数式组件 + Hooks
- **状态管理**: React Context
- **类型定义**: 严格模式，无any

### 5.3 错误处理
- 所有API调用必须有try-catch
- 用户友好错误提示（message.error）
- 日志记录（logger_tool / logger_api）

### 5.4 性能要求
- 组件渲染时间<100ms
- 首屏加载时间<3s
- 内存占用<200MB

---

## 六、风险应对

| 风险 | 概率 | 影响 | 应对策略 |
|------|------|------|---------|
| 流式API不稳定 | 中 | 高 | 准备降级方案（非流式），增加重试机制 |
| 样式兼容性 | 低 | 中 | 使用Ant Design组件，减少自定义样式 |
| 测试覆盖不足 | 中 | 中 | Day8专门测试，预留修复时间 |
| Day8前无法完成 | 低 | 高 | 优先保证P0级任务，P1级可延期 |

---

## 七、交付物清单

### 代码交付物
- [ ] 10个前端组件/功能（代码+单元测试）
- [ ] Layout组件
- [ ] MessageItem组件
- [ ] ExecutionPanel组件
- [ ] DangerConfirmModal组件
- [ ] Sidebar组件
- [ ] SettingsPage页面
- [ ] HistoryPage页面
- [ ] 流式API Hook
- [ ] 消息复制功能
- [ ] 前端单元测试（覆盖率>80%）

### 文档交付物
- [ ] 组件使用说明
- [ ] Mock数据文件
- [ ] 测试报告

---

## 八、计划执行状态

| 天数 | 日期 | 任务 | 状态 |
|------|------|------|------|
| Day 1 | 2026-02-20 | 消息组件美化 + Layout布局重构 | ⏳ 待开始 |
| Day 2 | 2026-02-21 | ExecutionPanel组件 | ⏳ 待开始 |
| Day 3 | 2026-02-22 | 危险操作弹窗 + 流式API准备 | ⏳ 待开始 |
| Day 4 | 2026-02-23 | 流式API对接 + Sidebar导航栏 | ⏳ 待开始 |
| Day 5 | 2026-02-24 | 设置页面 | ⏳ 待开始 |
| Day 6 | 2026-02-25 | 历史会话页面 | ⏳ 待开始 |
| Day 7 | 2026-02-26 | 消息复制功能 + 优化完善 | ⏳ 待开始 |
| Day 8 | 2026-02-27 | 前端单元测试 | ⏳ 待开始 |

---

**计划状态**: ⏳ 等待北京老陈确认后开始执行  
**预计完成**: 2026-02-27  
**总工时**: 52小时（8个工作日）

---

**制定人**: 小新  
**制定时间**: 2026-02-19 23:43:26  
**版本**: v1.0
