# 安装日志-2026-02-06

**创建时间**: 2026-02-06 09:54:20  
**存放位置**: D:\2bktest\MDview\

---

## 1 Python读取DOCX问题及解决 【DOCX读取与编码处理】2026-02-06 09:54:20

### 1.1 问题背景

**任务**: 检查MD文档转换是否有错误，需要对照原始DOCX文件  
**问题**: 发现MD文档中案件ID标注错误（`*案件ID【用户录入】`），需要验证原始DOCX内容  
**难点**: 当前环境缺少必要的Python库和配置，无法正常读取DOCX

### 1.2 遇到的问题及解决过程

#### 1.2.1 Python缺少pip

**现象**:
```bash
E:/0APPsoftware/Python313/python -m pip install python-docx
# 错误: No module named pip
```

**尝试与结果**:
- 使用ensurepip安装 → 失败（No module named ensurepip）
- 下载get-pip.py安装 → 成功安装pip-26.0.1，但Python启动时site-packages未被加载

**发现**: pip安装在site-packages，但Python启动时site-packages路径未添加到sys.path

#### 1.2.2 site-packages路径未自动加载

**现象**:
```python
import sys
print(sys.path)
# 结果缺少site-packages路径
```

**根因**: `sys.flags.no_site = 1`，导致site.py模块未被自动导入

#### 1.2.3 site.py文件缺失

**发现**: Lib目录只有site-packages子目录，缺少site.py标准库文件

**解决**: 手动创建site.py文件，添加site-packages路径加载逻辑

#### 1.2.4 终端显示乱码

**现象**: 终端输出中文显示为乱码（如：`����ʦ��`）

**原因**: Git Bash终端编码与Python输出编码不匹配

**解决**: 将内容写入文件而非直接输出到终端，使用UTF-8编码

### 1.3 最终解决方案

**方案**: 放弃依赖python-docx库，使用Python标准库直接读取DOCX

**原理**: DOCX文件实际上是ZIP压缩包，包含XML文件

**实现代码**:
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import zipfile
import xml.etree.ElementTree as ET

def read_docx(docx_path):
    """读取DOCX文件并返回段落列表"""
    
    with zipfile.ZipFile(docx_path, 'r') as zip_file:
        xml_content = zip_file.read('word/document.xml')
    
    text = xml_content.decode('utf-8')
    root = ET.fromstring(text)
    namespaces = {'w': 'http://schemas.openxmlformats.org/wordprocessingml/2006/main'}
    
    paragraphs = []
    for para in root.findall('.//w:p', namespaces):
        texts = [node.text for node in para.findall('.//w:t', namespaces) if node.text]
        if texts:
            paragraphs.append(''.join(texts))
    
    return paragraphs
```

**关键步骤**:
1. 使用`zipfile`库读取DOCX（DOCX是ZIP格式）
2. 提取`word/document.xml`文件
3. 使用`xml.etree.ElementTree`解析XML
4. 查找所有`<w:p>`标签（段落）和`<w:t>`标签（文本）
5. 将结果写入UTF-8编码的文本文件

### 1.4 发现并修正的错误

**错误**: MD文档转换时，【】标注错位

**原始DOCX内容**:
```
系统创建：*案件ID
-案源信息【用户录入】
```

**转换后MD（错误）**:
```markdown
*案件ID【用户录入】  ← 错误！【用户录入】被错误合并到案件ID
```

**修正后MD**:
```markdown
*案件ID
#### 案源信息【用户录入】  ← 正确！
```

**修正方法**:
```bash
sed -i 's/\*案件ID\[用户录入\]/*案件ID/' "律师云系统-原始需求-0117-W2.2.md"
```

### 1.5 经验教训

#### 1.5.1 Python环境问题
- **教训**: Python安装不完整（缺少site.py标准库）
- **建议**: 安装Python时应使用官方安装程序，确保安装标准库

#### 1.5.2 依赖管理
- **教训**: 不要过度依赖第三方库（如python-docx）
- **建议**: 优先使用标准库，DOCX格式本质是ZIP+XML，标准库即可处理

#### 1.5.3 编码问题
- **教训**: 终端编码与文件编码可能不一致
- **建议**: 重要内容写入文件而非直接输出到终端，确保使用UTF-8编码

#### 1.5.4 文档转换
- **教训**: DOCX转Markdown存在格式丢失和错位风险
- **建议**: 关键标注（如【】）需要人工复核，分段和缩进可能发生变化

#### 1.5.5 调试方法
- **成功方法**: 
  1. 分解问题（读取文件→解析XML→提取文本→写入文件）
  2. 逐步验证（每个步骤输出中间结果）
  3. 使用文件而非终端查看结果（避免编码干扰）

### 1.6 相关文件

**创建的脚本**:
- `D:\2bktest\MDview\read_docx.py` - 读取DOCX的通用脚本
- `D:\2bktest\MDview\doc_full.txt` - 提取的DOCX完整文本

**修改的文件**:
- `E:\0APPsoftware\Python313\Lib\site.py` - 手动创建的标准库文件
- `D:\2bktest\MDview\LAW初版需求\01-核心文档\律师云系统-原始需求-0117-W2.2.md` - 修正标注错误

### 1.7 后续建议

1. **Python环境**: 建议重新安装完整的Python发行版，确保所有标准库完整
2. **需求文档**: 建议建立MD文档审核机制，转换后与原始DOCX对照检查
3. **工具链**: 考虑使用Pandoc等专业工具进行DOCX↔Markdown转换
4. **备份**: 保留原始DOCX文件作为权威来源，MD文档作为工作副本

---

## 2 Python环境最终修复 【重装Python彻底解决pip问题】2026-02-06 22:30:00

### 2.1 最终解决方案

**方案**: 彻底卸载旧Python，重新安装官方完整版

**执行步骤**:
1. **彻底卸载**
   - 控制面板卸载所有Python版本（3.11、3.12、3.13）
   - 手动删除残留目录
   - 清理环境变量中的Python路径
   - 重启电脑

2. **重新安装**
   - 版本：Python 3.13.11
   - 路径：`E:\0APPsoftware\Python31311\`
   - 勾选 "Add Python to PATH"
   - 勾选 "Install pip"

3. **验证安装**
   ```powershell
   PS C:\Users\40968> python --version
   Python 3.13.11
   
   PS C:\Users\40968> pip --version
   pip 25.3 from E:\0APPsoftware\Python31311\Lib\site-packages\pip (python 3.13)
   ```

### 2.2 安装后验证

**测试命令**:
```powershell
# Python版本
python --version
# 输出: Python 3.13.11

# Pip版本
pip --version
# 输出: pip 25.3 from E:\0APPsoftware\Python31311\Lib\site-packages\pip (python 3.13)

# 测试安装包
pip install python-docx
# Successfully installed python-docx-1.1.2
```

**验证结果**: ✅ 所有功能正常，pip可直接使用

### 2.3 经验教训

1. **不要安装多版本Python**：容易造成环境混乱
2. **卸载要彻底**：包括注册表和环境变量清理
3. **安装时勾选必要选项**："Add to PATH"和"Install pip"必须勾选
4. **安装后重启**：确保环境变量生效

### 2.4 最终状态

- ✅ Python 3.13.11 - 安装成功
- ✅ Pip 25.3 - 正常工作
- ✅ 无需额外配置 - 开箱即用
- ✅ 所有脚本可正常运行

---

**更新时间**: 2026-02-06 22:30:00，更新事由：添加Python环境最终修复记录，记录完整的卸载重装过程和验证结果
