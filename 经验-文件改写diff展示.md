# 工作经验：文档更新规范

**记录时间**: 2026-02-08 05:20:00  
**场景**: Pencil安装研究总结文档更新  
**类型**: 流程规范/经验教训

---

## 一、事件回顾

### 1.1 发生了什么

在更新《Pencil安装研究总结.md》文档时（v1.0 → v1.1），我**直接使用了 write 工具覆盖了整个文件**，而不是使用 edit 工具展示具体的修改内容。

### 1.2 产生的问题

- ❌ **用户无法看到具体改了哪些行** - 不知道修改的范围和内容
- ❌ **无法对比新旧版本** - 失去了变更的可追溯性
- ❌ **缺乏确认环节** - 没有给用户审核修改的机会
- ❌ **风险较高** - 如果改错了，无法快速定位和回滚

### 1.3 用户的反馈

> "这里有一个更改功能，为什么你不要更改模式，是不是就可以做更改页面查看哪些更改的？"

用户明确指出：**应该使用更改模式（diff）来展示修改，让用户清楚看到改了什么**。

---

## 二、正确的做法

### 2.1 什么时候用 write（全量写入）

✅ **适用场景**:
- 首次创建新文件
- 文件内容完全重写（结构、章节全部变更）
- 临时文件或缓存文件
- 自动生成的不需要人工审核的内容

### 2.2 什么时候用 edit（增量修改）

✅ **适用场景**:
- 修改现有文件的特定内容
- 需要用户确认修改内容
- 保留变更历史（便于 diff）
- 多人协作的文档
- 重要配置文件的更新

### 2.3 最佳实践流程

**对于重要文档更新，标准流程应该是：**

```
步骤1: 读取原文件
  ↓
步骤2: 分析需要修改的内容
  ↓
步骤3: 生成变更方案（diff/对比）
  ↓
步骤4: 展示给用户确认
  示例：
  "计划修改以下内容：
   - 第X行：旧内容 → 新内容
   - 第Y段：删除/新增
   请确认是否正确？"
  ↓
步骤5: 用户确认后执行修改
  ↓
步骤6: 验证修改结果
  ↓
步骤7: 记录变更日志
```

---

## 三、edit 工具使用规范

### 3.1 基本语法

```javascript
// 修改指定内容
edit({
  filePath: "文档路径",
  oldString: "原有的文本内容",
  newString: "新的文本内容"
})
```

### 3.2 使用示例

**示例1：修改单行内容**
```javascript
edit({
  filePath: "D:/project/README.md",
  oldString: "**版本**: v1.0",
  newString: "**版本**: v1.1"
})
```

**示例2：修改段落**
```javascript
edit({
  filePath: "D:/project/doc.md",
  oldString: "## 第一章\n\n旧的内容...",
  newString: "## 第一章\n\n新的内容..."
})
```

**示例3：添加新章节**
```javascript
edit({
  filePath: "D:/project/doc.md",
  oldString: "## 最后一章\n\n内容...",
  newString: "## 最后一章\n\n内容...\n\n## 新增章节\n\n新内容..."
})
```

### 3.3 注意事项

⚠️ **必须遵守**:
1. **先读后改** - 必须使用 read 工具先读取文件
2. **唯一匹配** - oldString 必须在文件中唯一，否则会报错
3. **上下文足够** - oldString 要包含足够的上下文，确保定位准确
4. **逐项修改** - 多个修改分多次 edit，不要一次性改太多
5. **立即验证** - 修改后立即验证结果

---

## 四、Git 方式（更专业的方案）

### 4.1 使用 Git 管理文档版本

```bash
# 1. 查看当前版本
git show HEAD:文档.md

# 2. 修改文件（用 edit 或直接编辑）
# ...

# 3. 查看修改了哪些内容
git diff 文档.md

# 4. 展示 diff 给用户确认
# 输出示例：
# - 旧内容
# + 新内容

# 5. 用户确认后提交
git add 文档.md
git commit -m "更新文档：修正xxx错误"
```

### 4.2 生成 diff 报告

可以在提交前生成详细的变更报告：

```
======================================================================
文档变更报告
======================================================================
文件: Pencil安装研究总结.md
版本: v1.0 → v1.1

【新增内容】
+ 重要更正说明章节
+ 扩展vs插件概念解释
+ Windows用户限制说明

【修改内容】
- 错误: "VS Code + OpenCode + Pencil"
+ 正确: "VS Code + Pencil（唯一可用）"

【删除内容】
- 关于OpenCode Desktop使用Pencil的错误描述

【统计】
新增行数: 50+
修改行数: 20+
删除行数: 10+
======================================================================
```

---

## 五、工作流程图

### 5.1 文档更新决策树

```
开始更新文档
    ↓
是否是新文件？
    ↓ 是
使用 write 创建
    ↓
结束
    
    ↓ 否（已有文件）
修改内容多吗？（超过50%）
    ↓ 是
用户是否要求查看变更？
    ↓ 否
使用 write 重写
    ↓
结束

    ↓ 否（修改较少）
或者用户要求查看变更
    ↓
使用 read 读取原文件
    ↓
使用 edit 逐项修改
每次修改后展示：
"修改第X行：
 - 旧: xxx
 + 新: xxx
 确认吗？"
    ↓
用户确认
    ↓
验证结果
    ↓
记录变更
    ↓
结束
```

---

## 六、经验教训

### 6.1 这次犯错的根本原因

1. **图省事** - 觉得用 write 一次性覆盖更快
2. **没考虑用户体验** - 没意识到用户需要看到具体改了什么
3. **缺乏规范意识** - 没有遵循"先展示后执行"的原则
4. **风险评估不足** - 没意识到直接覆盖的风险

### 6.2 核心原则（必须记住）

🔴 **铁律1：先展示，后执行**
- 任何重要修改都要先展示变更内容
- 等用户确认后再执行
- 不要擅自做主直接修改

🔴 **铁律2：可追溯，可回滚**
- 保留修改历史
- 方便对比新旧版本
- 出错时能快速恢复

🔴 **铁律3：小步快跑**
- 大修改拆分成小步骤
- 每次修改独立验证
- 降低出错风险

### 6.3 用户沟通话术

**正确的说法**：
```
"计划对文档进行以下修改：
1. 第5行：'版本: v1.0' → '版本: v1.1'
2. 第10-15行：新增'重要更正说明'章节
3. 第20行：删除错误描述

这是修改后的 diff，请确认是否正确？
确认后我将执行更新。"
```

**错误的说法**：
```
"文档已更新完成！"（用户不知道改了什么）
```

---

## 七、检查清单

**更新文档前，必须检查**：

- [ ] 是否已读取原文件？
- [ ] 是否分析了修改范围？
- [ ] 是否需要用户确认？
- [ ] 是否生成了变更对比？
- [ ] 是否等待用户确认？
- [ ] 修改后是否验证了结果？
- [ ] 是否记录了变更日志？

---

## 八、相关文档

- **本文件位置**: `D:\2bktest\MDview\工作经验-文档更新规范.md`
- **规范与规则目录**: `D:\50RuleTool\规范与规则\`
- **AI工具研究目录**: `D:\2bktest\MDview\AI工具研究\`

---

**记录人**: OpenCode AI Assistant  
**状态**: 已吸取教训，下次严格遵守  
**下次更新此文档时**: 必须用 edit 工具逐项修改，不能用 write 覆盖！
